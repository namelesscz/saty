<?xml version="1.0" encoding="utf-8"?>
<modification>
<name>Complete Marketing Manager</name>
<version>3.0</version>
<code>Complete Marketing Manager by Infinia</code>
<author>Infinia Systems</author>
<link>http://mods.infinia.systems/marketing-manager</link>

<file path="admin/controller/setting/store.php">
	<operation>	<!--    Conversion    -->
		<search><![CDATA[$data['tab_server'] = $this->language->get('tab_server');]]></search>
		<add position="after"><![CDATA[
	$this->language->load('setting/conversion');
	$data['tab_conversion'] = $this->language->get('tab_conversion');
	$data['entry_google_conversion_snippet'] = $this->language->get('entry_google_conversion_snippet');
	$data['entry_google_conversion_value'] = $this->language->get('entry_google_conversion_value');
	$data['entry_google_ecommerce_value'] = $this->language->get('entry_google_ecommerce_value');
	$data['text_google_conversion_code'] = $this->language->get('text_google_conversion_code');

	$data['help_google_conversion_snippet'] = $this->language->get('help_google_conversion_snippet');
	$data['help_google_conversion_value'] = $this->language->get('help_google_conversion_value');
	$data['help_google_ecommerce_value'] = $this->language->get('help_google_ecommerce_value');

	$data['text_universal_conversion_code'] = $this->language->get('text_universal_conversion_code');
	$data['entry_universal_conversion_code'] = $this->language->get('entry_universal_conversion_code');
	$data['help_universal_conversion_code'] = $this->language->get('help_universal_conversion_code');
]]></add>
	</operation>
</file>

<file path="admin/controller/setting/setting.php">
	<operation>	<!--    Conversion    -->
		<search><![CDATA[$data['tab_server'] = $this->language->get('tab_server');]]></search>
		<add position="after"><![CDATA[
	$this->language->load('setting/conversion');
	$data['tab_conversion'] = $this->language->get('tab_conversion');
	$data['entry_google_conversion_snippet'] = $this->language->get('entry_google_conversion_snippet');
	$data['entry_google_conversion_value'] = $this->language->get('entry_google_conversion_value');
	$data['entry_google_ecommerce_value'] = $this->language->get('entry_google_ecommerce_value');
	$data['text_google_conversion_code'] = $this->language->get('text_google_conversion_code');

	$data['help_google_conversion_snippet'] = $this->language->get('help_google_conversion_snippet');
	$data['help_google_conversion_value'] = $this->language->get('help_google_conversion_value');
	$data['help_google_ecommerce_value'] = $this->language->get('help_google_ecommerce_value');

	$data['text_universal_conversion_code'] = $this->language->get('text_universal_conversion_code');
	$data['entry_universal_conversion_code'] = $this->language->get('entry_universal_conversion_code');
	$data['help_universal_conversion_code'] = $this->language->get('help_universal_conversion_code');
]]></add>
	</operation>
</file>

<file path="admin/controller/setting/setting.php">
	<operation>	<!--    Conversion    -->
		<search><![CDATA[$this->model_localisation_language->getLanguages();]]></search>
		<add position="after"><![CDATA[
	if (isset($this->request->post['config_conversion_manager_google_snippet'])) {
		$data['config_conversion_manager_google_snippet'] = $this->request->post['config_conversion_manager_google_snippet'];
	} else {
		$data['config_conversion_manager_google_snippet'] = $this->config->get('config_conversion_manager_google_snippet');
	}
	if (isset($this->request->post['config_conversion_manager_status'])) {
		$data['config_conversion_manager_status'] = $this->request->post['config_conversion_manager_status'];
	} else {
		$data['config_conversion_manager_status'] = $this->config->get('config_conversion_manager_status');
	}
	if (isset($this->request->post['config_conversion_manager_ecommerce_status'])) {
		$data['config_conversion_manager_ecommerce_status'] = $this->request->post['config_conversion_manager_ecommerce_status'];
	} else {
		$data['config_conversion_manager_ecommerce_status'] = $this->config->get('config_conversion_manager_ecommerce_status');
	}
	if (isset($this->request->post['config_conversion_manager_universal_code'])) {
		$data['config_conversion_manager_universal_code'] = $this->request->post['config_conversion_manager_universal_code'];
	} else {
		$data['config_conversion_manager_universal_code'] = $this->config->get('config_conversion_manager_universal_code');
	}
]]></add>
	</operation>
</file>

<file path="admin/controller/setting/store.php">
	<operation>	<!--    Conversion    -->
		<search><![CDATA[$this->model_localisation_language->getLanguages();]]></search>
		<add position="after"><![CDATA[
	$this->load->language('setting/setting');
	$data['text_enabled'] = $this->language->get('text_enabled');
	$data['text_disabled'] = $this->language->get('text_disabled');

	if (isset($this->request->post['config_conversion_manager_google_snippet'])) {
		$data['config_conversion_manager_google_snippet'] = $this->request->post['config_conversion_manager_google_snippet'];
	} elseif (isset($store_info['config_conversion_manager_google_snippet'])) {
		$data['config_conversion_manager_google_snippet'] = $store_info['config_conversion_manager_google_snippet'];
	} else {
		$data['config_conversion_manager_google_snippet']='';
	}
	if (isset($this->request->post['config_conversion_manager_status'])) {
		$data['config_conversion_manager_status'] = $this->request->post['config_conversion_manager_status'];
	} elseif (isset($store_info['config_conversion_manager_status'])) {
		$data['config_conversion_manager_status'] = $store_info['config_conversion_manager_status'];
	} else {
		$data['config_conversion_manager_status'] = '';
	}
	if (isset($this->request->post['config_conversion_manager_ecommerce_status'])) {
		$data['config_conversion_manager_ecommerce_status'] = $this->request->post['config_conversion_manager_ecommerce_status'];
	} elseif (isset($store_info['config_conversion_manager_ecommerce_status'])) {
		$data['config_conversion_manager_ecommerce_status'] = $store_info['config_conversion_manager_ecommerce_status'];
	} else {
		$data['config_conversion_manager_ecommerce_status'] = '';
	}
	if (isset($this->request->post['config_conversion_manager_universal_code'])) {
		$data['config_conversion_manager_universal_code'] = $this->request->post['config_conversion_manager_universal_code'];
	} elseif (isset($store_info['config_conversion_manager_universal_code'])) {
		$data['config_conversion_manager_universal_code'] = $store_info['config_conversion_manager_universal_code'];
	} else {
		$data['config_conversion_manager_universal_code']='';
	}
]]></add>
	</operation>
</file>

<file path="admin/view/template/setting/store_form.tpl">
	<operation>        <!--    Conversion    -->
		<search><![CDATA["#tab-server"]]></search>
		<add position="before"><![CDATA[<li><a href="#tab-conversion" data-toggle="tab"><?php echo $tab_conversion; ?></a></li>]]></add>
	</operation>

	<operation>
		<search><![CDATA[id="tab-server"]]></search>
		<add position="before"><![CDATA[
	<div class="tab-pane" id="tab-conversion">
		<fieldset>
			<legend><?php echo $text_google_conversion_code; ?></legend>
			<div class="alert alert-info"><?php echo $help_google_conversion_snippet; ?></div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-conversion-snippet"><?php echo $entry_google_conversion_snippet; ?></label>
				<div class="col-sm-10">
					<textarea name="config_conversion_manager_google_snippet" rows="5" placeholder="<?php echo $entry_google_conversion_snippet; ?>" id="input-google-conversion-snippet" class="form-control"><?php echo $config_conversion_manager_google_snippet; ?></textarea>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-conversion-status"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_conversion_value); ?>"><?php echo $entry_google_conversion_value; ?></span></label>
				<div class="col-sm-10">
					<select name="config_conversion_manager_status" id="input-google-conversion-value" class="form-control">
						<?php if ($config_conversion_manager_status) { ?>
							<option value="1" selected="selected"><?php echo $text_enabled; ?></option>
							<option value="0"><?php echo $text_disabled; ?></option>
						<?php } else { ?>
							<option value="1"><?php echo $text_enabled; ?></option>
							<option value="0" selected="selected"><?php echo $text_disabled; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-ecommerce-value"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_ecommerce_value); ?>"><?php echo $entry_google_ecommerce_value; ?></span></label>
				<div class="col-sm-10">
					<select name="config_conversion_manager_ecommerce_status" id="input-google-ecommerce-value" class="form-control">
						<?php if ($config_conversion_manager_ecommerce_status) { ?>
							<option value="1" selected="selected"><?php echo $text_enabled; ?></option>
							<option value="0"><?php echo $text_disabled; ?></option>
						<?php } else { ?>
							<option value="1"><?php echo $text_enabled; ?></option>
							<option value="0" selected="selected"><?php echo $text_disabled; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>
		</fieldset>
		<fieldset>
			<legend><?php echo $text_universal_conversion_code; ?></legend>
			<div class="alert alert-info"><?php echo $help_universal_conversion_code; ?></div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-universal-conversion-code"><?php echo $entry_universal_conversion_code; ?></label>
				<div class="col-sm-10">
					<textarea name="config_conversion_manager_universal_code" rows="5" placeholder="<?php echo $entry_universal_conversion_code; ?>" id="input-universal-conversion-code" class="form-control"><?php echo $config_conversion_manager_universal_code; ?></textarea>
				</div>
			</div>
		</fieldset>
	</div>
]]></add>
		</operation>
</file>

<file path="admin/view/template/setting/setting.tpl">
	<operation>        <!--    Conversion    -->
		<search><![CDATA["#tab-server"]]></search>
		<add position="before"><![CDATA[<li><a href="#tab-conversion" data-toggle="tab"><?php echo $tab_conversion; ?></a></li>]]></add>
	</operation>

	<operation>
		<search><![CDATA[id="tab-server"]]></search>
		<add position="before"><![CDATA[
	<div class="tab-pane" id="tab-conversion">
		<fieldset>
			<legend><?php echo $text_google_conversion_code; ?></legend>
			<div class="alert alert-info"><?php echo $help_google_conversion_snippet; ?></div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-conversion-snippet"><?php echo $entry_google_conversion_snippet; ?></label>
				<div class="col-sm-10">
					<textarea name="config_conversion_manager_google_snippet" rows="5" placeholder="<?php echo $entry_google_conversion_snippet; ?>" id="input-google-conversion-snippet" class="form-control"><?php echo $config_conversion_manager_google_snippet; ?></textarea>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-conversion-status"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_conversion_value); ?>"><?php echo $entry_google_conversion_value; ?></span></label>
				<div class="col-sm-10">
					<select name="config_conversion_manager_status" id="input-google-conversion-value" class="form-control">
						<?php if ($config_conversion_manager_status) { ?>
							<option value="1" selected="selected"><?php echo $text_enabled; ?></option>
							<option value="0"><?php echo $text_disabled; ?></option>
						<?php } else { ?>
							<option value="1"><?php echo $text_enabled; ?></option>
							<option value="0" selected="selected"><?php echo $text_disabled; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-ecommerce-value"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_ecommerce_value); ?>"><?php echo $entry_google_ecommerce_value; ?></span></label>
				<div class="col-sm-10">
					<select name="config_conversion_manager_ecommerce_status" id="input-google-ecommerce-value" class="form-control">
						<?php if ($config_conversion_manager_ecommerce_status) { ?>
							<option value="1" selected="selected"><?php echo $text_enabled; ?></option>
							<option value="0"><?php echo $text_disabled; ?></option>
						<?php } else { ?>
							<option value="1"><?php echo $text_enabled; ?></option>
							<option value="0" selected="selected"><?php echo $text_disabled; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>
		</fieldset>
		<fieldset>
			<legend><?php echo $text_universal_conversion_code; ?></legend>
			<div class="alert alert-info"><?php echo $help_universal_conversion_code; ?></div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-universal-conversion-code"><?php echo $entry_universal_conversion_code; ?></label>
				<div class="col-sm-10">
					<textarea name="config_conversion_manager_universal_code" rows="5" placeholder="<?php echo $entry_universal_conversion_code; ?>" id="input-universal-conversion-code" class="form-control"><?php echo $config_conversion_manager_universal_code; ?></textarea>
				</div>
			</div>
		</fieldset>
	</div>
]]></add>
		</operation>
</file>

<file path="catalog/controller/svea/success.php">  <!-- Swedish checkout Svea Ekonomi -->
	<operation error="skip">
		<search><![CDATA['shipping_method']]></search>
		<add position="before"><![CDATA[
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	$remarketing_price=0;
	$facebook_remarketing_id = '';
	$google_ecommerce_ga = '';
	$google_ecommerce_gtag = '';
	$ecommerce_products_ga = '';
	$ecommerce_products_gtag = '';
	$this->load->model('checkout/order');
	$order_id=$this->session->data['order_id'];
	$products=$this->model_checkout_order->getCheckoutProducts($order_id);
	$multi_prefix='';
	$multi_postfix='';
	if (count($products)>1){
		$multi_prefix='[';
		$multi_postfix=']';
	}
	$products_price=0;
	foreach ($products as $product) {
		if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
			$remarketing_id_1 = $remarketing_id_1.'\''.$product['product_id'].'\',';
		else
			$remarketing_id_1 = $remarketing_id_1.'\''.$product['model'].'\',';
		if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
			$remarketing_id_2 = $remarketing_id_2.'\''.$product['product_id'].'\',';
		elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
			$remarketing_id_2 = $remarketing_id_2.'\''.$product['model'].'\',';
		if ($remarketing_id_1==$remarketing_id_2)
			$remarketing_id_2='\'\',';
		if ($this->config->get('config_remarketing_manager_facebook_id')=='product_id')
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.$product['product_id'].'\',';
		else
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.$product['model'].'\',';
		$remarketing_price = $remarketing_price+(float)$product['price']*(float)$product['quantity'];
		$products_price=$products_price+(float) $product['price']*(float)$product['quantity'];
	//OLD GA
		$ecommerce_products_ga = $ecommerce_products_ga.'ga(\'ecommerce:addItem\', {
\'id\': \''.$order_id.'\',
\'name\': \''.$product['name'].'\',
\'sku\': \''.$product['model'].'\',
\'price\': \''.$product['price'].'\',
\'quantity\': \''.$product['quantity'].'\'
});
	';
	//NEW GTAG
		$ecommerce_products_gtag = $ecommerce_products_gtag.',
{
"id": "'.$product['model'].'",
"name": "'.$product['name'].'",
"price": \''.$product['price'].'\',
"quantity": '.$product['quantity'].'
}';
	}
	$remarketing_id_1=trim($remarketing_id_1, ',');
	$remarketing_id_2=trim($remarketing_id_2, ',');
	$facebook_remarketing_id=trim($facebook_remarketing_id, ',');
	$this->load->model('catalog/category');
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"purchase","conversion",$multi_prefix,$multi_postfix);
	$this->model_catalog_category->setFacebookPixel($facebook_remarketing_id,$remarketing_price,"Purchase","Purchase","product",count($products));
	if ($this->config->get('config_conversion_manager_ecommerce_status')==1) {
		//OLD GA
		$google_ecommerce_ga = $google_ecommerce_ga.'ga(\'require\', \'ecommerce\');
ga(\'ecommerce:addTransaction\', {
\'id\': \''.$order_id.'\',
\'revenue\': \''.$products_price.'\',
\'currency\': \''.$this->session->data['currency'].'\'
});
	';
		$google_ecommerce_ga = $google_ecommerce_ga.$ecommerce_products_ga;
		$google_ecommerce_ga = $google_ecommerce_ga. 'ga(\'ecommerce:send\');
		';
		$this->document->setEcommerceGoogleGA(html_entity_decode($google_ecommerce_ga, ENT_QUOTES, 'UTF-8'));
		//NEW GTAG
		$ecommerce_products_gtag=substr_replace ( $ecommerce_products_gtag , "" , 0 ,1 );
		$ecommerce_products_gtag='gtag(\'event\', \'purchase\', {
"transaction_id": "'.$order_id.'",
"value": '.$products_price.',
"currency": "'.$this->session->data['currency'].'",
"items": ['.$ecommerce_products_gtag.']
});';
		$this->document->setEcommerceGoogleGTAG(html_entity_decode($ecommerce_products_gtag, ENT_QUOTES, 'UTF-8'));
	}
]]></add>
	</operation>
</file>

<file path="catalog/controller/svea/checkout.php">   <!-- Swedish checkout Svea Ekonomi  -->
	<operation error="skip">
		<search><![CDATA[['header']]]></search>
		<add position="before"><![CDATA[
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	$facebook_remarketing_id = '';
	$remarketing_price=0;
	$multi_prefix='';
	$multi_postfix='';
	if (count($products)>1){
		$multi_prefix='[';
		$multi_postfix=']';
	}
	foreach ($products as $product) {
		if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
			$remarketing_id_1 = $remarketing_id_1.'\''.$product['product_id'].'\',';
		else
			$remarketing_id_1 = $remarketing_id_1.'\''.str_replace(',','',$product['model']).'\',';
		if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
			$remarketing_id_2 = $remarketing_id_2.'\''.$product['product_id'].'\',';
		elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
			$remarketing_id_2 = $remarketing_id_2.'\''.str_replace(',','',$product['model']).'\',';
		if ($remarketing_id_1==$remarketing_id_2)
			$remarketing_id_2='\'\',';
		if ($this->config->get('config_remarketing_manager_facebook_id')=='product_id')
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.$product['product_id'].'\',';
		else
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.str_replace(',','',$product['model']).'\',';
		$remarketing_price = $remarketing_price+(float) $this->currency->format($this->tax->calculate($product['price'], $product['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false) *(float)$product['quantity'];
	}
	$remarketing_id_1=trim($remarketing_id_1, ',');
	$remarketing_id_2=trim($remarketing_id_2, ',');
	$facebook_remarketing_id=trim($facebook_remarketing_id, ',');
	$this->load->model('catalog/category');
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"cart","conversionintent",$multi_prefix,$multi_postfix);
	$this->model_catalog_category->setFacebookPixel($facebook_remarketing_id,$remarketing_price,"InitiateCheckout","Checkout","product",count($products));
]]></add>
	</operation>
</file>

<file path="catalog/controller/checkout/*success*.php">
	<operation>	 <!--    Conversion    -->
		<search><![CDATA[$this->cart->clear();]]></search>
		<add position="after"><![CDATA[
	$conversion_tracking;
	$this->load->model('checkout/order');
	$order_info=$this->model_checkout_order->getOrder($this->session->data['order_id']);
	$conversion_tracking=html_entity_decode($this->config->get('config_conversion_manager_google_snippet'), ENT_QUOTES, 'UTF-8');
	if ($this->config->get('config_conversion_manager_status')==1) {
		if (stripos($conversion_tracking,'gtag')!==false){ // new gtag conversion
			if (stripos($conversion_tracking,'value')!==false){
				$start_index=stripos($conversion_tracking,'value');
				$end_index=stripos($conversion_tracking,PHP_EOL,$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'value\': '.round($order_info['total'], 2).',',$start_index,$end_index-$start_index);
			}
			if (strripos($conversion_tracking,'currency')!==false){
				$start_index=strripos($conversion_tracking,'currency');
				$end_index=stripos($conversion_tracking,PHP_EOL,$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'currency\': \''.$order_info['currency_code'].'\',',$start_index,$end_index-$start_index);
			}
			if (strripos($conversion_tracking,'transaction_id')!==false){
				$start_index=strripos($conversion_tracking,'transaction_id');
				$end_index=stripos($conversion_tracking,PHP_EOL,$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'transaction_id\': \''.$order_info['order_id'].'\',',$start_index,$end_index-$start_index);
			}
		} else { //legacy conversion
			if (stripos($conversion_tracking,'google_conversion_value')!==false){
				$start_index=stripos($conversion_tracking,'google_conversion_value');
				$end_index=stripos($conversion_tracking,';',$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'google_conversion_value = '.round($order_info['total'], 2),$start_index,$end_index-$start_index);
			}
			if (stripos($conversion_tracking,'google_conversion_currency')!==false){
				$start_index=stripos($conversion_tracking,'google_conversion_currency');
				$end_index=stripos($conversion_tracking,';',$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'google_conversion_currency = "'.$order_info['currency_code'].'"',$start_index,$end_index-$start_index);
			}
			if (strripos($conversion_tracking,'value=')!==false){
				$start_index=strripos($conversion_tracking,'value=');
				$end_index=stripos($conversion_tracking,'&',$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'value='.round($order_info['total'], 2),$start_index,$end_index-$start_index);
			}
			if (strripos($conversion_tracking,'currency_code=')!==false){
				$start_index=strripos($conversion_tracking,'currency_code=');
				$end_index=stripos($conversion_tracking,'&',$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'currency_code='.$order_info['currency_code'],$start_index,$end_index-$start_index);
			}
		}
	}
	$this->document->setConversionGoogle(html_entity_decode($conversion_tracking, ENT_QUOTES, 'UTF-8'));
	$universal_conversion_code=$this->config->get('config_conversion_manager_universal_code');
	$universal_conversion_code=str_replace ( '#order_id', $order_info['order_id'] , $universal_conversion_code );
	$universal_conversion_code=str_replace ( '#total', round($order_info['total'], 2) , $universal_conversion_code );
	$universal_conversion_code=str_replace ( '#currency', $order_info['currency_code'] , $universal_conversion_code );
	$this->document->setConversionUniversal(html_entity_decode($universal_conversion_code, ENT_QUOTES, 'UTF-8'));
]]></add>
	</operation>
</file>

<file path="catalog/controller/onepagecheckout/ordersuccess.php">
	<operation>	 <!--    Conversion    -->
		<search><![CDATA[$this->cart->clear();]]></search>
		<add position="after"><![CDATA[
	$conversion_tracking;
	$this->load->model('checkout/order');
	$order_info=$this->model_checkout_order->getOrder($this->session->data['order_id']);
	$conversion_tracking=html_entity_decode($this->config->get('config_conversion_manager_google_snippet'), ENT_QUOTES, 'UTF-8');
	if ($this->config->get('config_conversion_manager_status')==1) {
		if (stripos($conversion_tracking,'gtag')!==false){ // new gtag conversion
			if (stripos($conversion_tracking,'value')!==false){
				$start_index=stripos($conversion_tracking,'value');
				$end_index=stripos($conversion_tracking,PHP_EOL,$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'value\': '.round($order_info['total'], 2).',',$start_index,$end_index-$start_index);
			}
			if (strripos($conversion_tracking,'currency')!==false){
				$start_index=strripos($conversion_tracking,'currency');
				$end_index=stripos($conversion_tracking,PHP_EOL,$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'currency\': \''.$order_info['currency_code'].'\',',$start_index,$end_index-$start_index);
			}
			if (strripos($conversion_tracking,'transaction_id')!==false){
				$start_index=strripos($conversion_tracking,'transaction_id');
				$end_index=stripos($conversion_tracking,PHP_EOL,$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'transaction_id\': \''.$order_info['order_id'].'\',',$start_index,$end_index-$start_index);
			}
		} else { //legacy conversion
			if (stripos($conversion_tracking,'google_conversion_value')!==false){
				$start_index=stripos($conversion_tracking,'google_conversion_value');
				$end_index=stripos($conversion_tracking,';',$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'google_conversion_value = '.round($order_info['total'], 2),$start_index,$end_index-$start_index);
			}
			if (stripos($conversion_tracking,'google_conversion_currency')!==false){
				$start_index=stripos($conversion_tracking,'google_conversion_currency');
				$end_index=stripos($conversion_tracking,';',$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'google_conversion_currency = "'.$order_info['currency_code'].'"',$start_index,$end_index-$start_index);
			}
			if (strripos($conversion_tracking,'value=')!==false){
				$start_index=strripos($conversion_tracking,'value=');
				$end_index=stripos($conversion_tracking,'&',$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'value='.round($order_info['total'], 2),$start_index,$end_index-$start_index);
			}
			if (strripos($conversion_tracking,'currency_code=')!==false){
				$start_index=strripos($conversion_tracking,'currency_code=');
				$end_index=stripos($conversion_tracking,'&',$start_index);
				$conversion_tracking = substr_replace($conversion_tracking,'currency_code='.$order_info['currency_code'],$start_index,$end_index-$start_index);
			}
		}
	}
	$this->document->setConversionGoogle(html_entity_decode($conversion_tracking, ENT_QUOTES, 'UTF-8'));
	$universal_conversion_code=$this->config->get('config_conversion_manager_universal_code');
	$universal_conversion_code=str_replace ( '#order_id', $order_info['order_id'] , $universal_conversion_code );
	$universal_conversion_code=str_replace ( '#total', round($order_info['total'], 2) , $universal_conversion_code );
	$universal_conversion_code=str_replace ( '#currency', $order_info['currency_code'] , $universal_conversion_code );
	$this->document->setConversionUniversal(html_entity_decode($universal_conversion_code, ENT_QUOTES, 'UTF-8'));
]]></add>
	</operation>
</file>

<file path="catalog/view/theme/*/template/common/footer.tpl">
	<operation>	<!--     Conversion     -->
		<search><![CDATA[</body>]]></search>
		<add position="before"><![CDATA[<?php if (isset($universal_conversion_code)) echo '<div style="display:none">'.$universal_conversion_code.'</div>'; ?>]]></add>
	</operation>
</file>

<file path="system/library/document.php">
	<operation>	<!--     Conversion     -->
		<search><![CDATA[public function setTitle($title) {]]></search>
		<add position="before"><![CDATA[
	private $conversionGoogle;
	public function setConversionGoogle($conversionGoogle) {
		$this->conversionGoogle = $conversionGoogle;
	}
	public function getConversionGoogle() {
		return $this->conversionGoogle;
	}
	private $conversionUniversal;
	public function setConversionUniversal($conversionUniversal) {
		$this->conversionUniversal = $conversionUniversal;
	}
	public function getConversionUniversal() {
		return $this->conversionUniversal;
	}
]]></add>
	</operation>
</file>

<file path="catalog/controller/common/footer.php">
	<operation>	<!--     Conversion     -->
		<search><![CDATA[['contact']]]></search>
		<add position="before"><![CDATA[
	$universal_conversion_code = $this->document->getConversionUniversal();
	if ($universal_conversion_code != ""){
		$data['universal_conversion_code'] = html_entity_decode($universal_conversion_code, ENT_QUOTES, 'UTF-8');}
]]></add>
	</operation>
</file>

<file path="system/library/document.php">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA[public function setTitle($title) {]]></search>
		<add position="before"><![CDATA[
	private $remarketingGoogleGA;
	public function setRemarketingGoogleGA($remarketingGoogleGA) {
		$this->remarketingGoogleGA = $remarketingGoogleGA;
	}
	public function getRemarketingGoogleGA() {
		return $this->remarketingGoogleGA;
	}
	private $remarketingGoogleGTAG;
	public function setRemarketingGoogleGTAG($remarketingGoogleGTAG) {
		$this->remarketingGoogleGTAG = $remarketingGoogleGTAG;
	}
	public function getRemarketingGoogleGTAG() {
		return $this->remarketingGoogleGTAG;
	}
	private $remarketingGoogleTag;
	public function setRemarketingGoogleTag($remarketingGoogleTag) {
		$this->remarketingGoogleTag = $remarketingGoogleTag;
	}
	public function getRemarketingGoogleTag() {
		return $this->remarketingGoogleTag;
	}
	private $remarketingFacebook;
	public function setRemarketingFacebook($remarketingFacebook) {
		$this->remarketingFacebook = $remarketingFacebook;
	}
	public function getRemarketingFacebook() {
		return $this->remarketingFacebook;
	}
	private $ecommerceGoogleGA;
	public function setEcommerceGoogleGA($ecommerceGoogleGA) {
		$this->ecommerceGoogleGA = $ecommerceGoogleGA;
	}
	public function getEcommerceGoogleGA() {
		return $this->ecommerceGoogleGA;
	}
	private $ecommerceGoogleGTAG;
	public function setEcommerceGoogleGTAG($ecommerceGoogleGTAG) {
		$this->ecommerceGoogleGTAG = $ecommerceGoogleGTAG;
	}
	public function getEcommerceGoogleGTAG() {
		return $this->ecommerceGoogleGTAG;
	}
]]></add>
	</operation>
</file>
<file path="catalog/controller/common/header.php">
	<operation>	<!--     Remarketing/Ecommerce     -->
		<search><![CDATA[index()]]></search>
		<add position="after"><![CDATA[
	$google_adwords_code = html_entity_decode($this->config->get('config_remarketing_manager_adwords_code'), ENT_QUOTES, 'UTF-8');
	$google_remarketing_tag = html_entity_decode($this->document->getRemarketingGoogleTag(), ENT_QUOTES, 'UTF-8');
	$remarketing_analytics=0;
	if ($google_remarketing_tag == ""){
		$google_remarketing_tag = html_entity_decode($this->config->get('config_remarketing_manager_google_snippet'), ENT_QUOTES, 'UTF-8');
		if ($google_remarketing_tag != ""){
			if (strpos($google_remarketing_tag, 'gtag')!==false){//new gtag
				if (strpos($google_remarketing_tag, 'ecomm_prodid')!==false){
					$google_remarketing_tag = str_replace('ecomm_prodid\': \'replace with value\'','ecomm_prodid\': \'\'',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('ecomm_pagetype\': \'replace with value\'','ecomm_pagetype\': \'other\'',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('\'ecomm_totalvalue\': \'replace with value\',','',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('\'ecomm_totalvalue\': \'replace with value\'','',$google_remarketing_tag);
				}
				if (strpos($google_remarketing_tag, 'dynx_itemid')!==false){
					$google_remarketing_tag = str_replace('dynx_itemid\': \'replace with value\'','dynx_itemid\': \'\'',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('dynx_itemid2\': \'replace with value\'','dynx_itemid2\': \'\'',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('dynx_pagetype\': \'replace with value\'','dynx_pagetype\': \'other\'',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('\'dynx_totalvalue\': \'replace with value\',','',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('\'dynx_totalvalue\': \'replace with value\'','',$google_remarketing_tag);
				}
				$google_remarketing_tag = str_replace('replace with value','',$google_remarketing_tag);
			} else {//legacy adwords
				if (strpos($google_remarketing_tag, 'ecomm_prodid')!==false){
					$google_remarketing_tag = str_replace('ecomm_prodid: \'REPLACE_WITH_VALUE\'','ecomm_prodid: \'\'',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('ecomm_pagetype: \'REPLACE_WITH_VALUE\'','ecomm_pagetype: \'other\'',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('ecomm_totalvalue: \'REPLACE_WITH_VALUE\',','',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('ecomm_totalvalue: \'REPLACE_WITH_VALUE\'','',$google_remarketing_tag);
				}
				if (strpos($google_remarketing_tag, 'dynx_itemid')!==false){
					$google_remarketing_tag = str_replace('dynx_itemid: \'REPLACE_WITH_VALUE\'','dynx_itemid: \'\'',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('dynx_itemid2: \'REPLACE_WITH_VALUE\'','dynx_itemid2: \'\'',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('dynx_pagetype: \'REPLACE_WITH_VALUE\'','dynx_pagetype: \'other\'',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('dynx_totalvalue: \'REPLACE_WITH_VALUE\',','',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('dynx_totalvalue: \'REPLACE_WITH_VALUE\'','',$google_remarketing_tag);
				}
				$google_remarketing_tag = str_replace('REPLACE_WITH_VALUE','',$google_remarketing_tag);
			}
		}
	}
	$google_global_tag = "";
	if (strpos($google_remarketing_tag, 'gtag')!==false){//new gtag only
		$start=strpos($google_remarketing_tag , "<script>");
		$end=strpos($google_remarketing_tag , "</script>");
		if ($start!==false && $end!==false) {
			$google_remarketing_tag=substr($google_remarketing_tag , $start+8 ,$end-$start-8);
		}
		$google_global_tag = $google_remarketing_tag;
		$google_remarketing_tag = "";
	}

	$google_conversion_code = $this->document->getConversionGoogle();
	if (strpos($google_conversion_code, 'gtag')!==false){//new gtag only
		$start=strpos($google_conversion_code , "<script>");
		$end=strpos($google_conversion_code , "</script>");
		if ($start!==false && $end!==false) {
			$google_conversion_code=substr($google_conversion_code , $start+8 ,$end-$start-8);
		}
		$google_global_tag = $google_global_tag.$google_conversion_code;
		$google_conversion_code = "";
	}
]]></add>
	</operation>
</file>
<file path="catalog/controller/common/header.php">
	<operation error="skip">	<!--     Remarketing/Ecommerce   oc>2031  -->
		<search index="0"><![CDATA[$data['analytics'][]]]></search>
		<add position="after"><![CDATA[
	if ($analytic['code'] == "google_analytics"){
		$google_analytics=array_pop($data['analytics']);
		if (strpos($google_analytics, 'gtag(')!==false ){
			$google_remarketing_gtag = $this->document->getRemarketingGoogleGTAG();
			$google_ecommerce_gtag = $this->document->getEcommerceGoogleGTAG();
			if ($google_remarketing_gtag != ""){
				$pos=strpos($google_analytics , "gtag('config'");
				if ($pos!==false){
					$pos=strpos($google_analytics , ");",$pos);
					if ($pos!==false) {
						$google_analytics = substr_replace ( $google_analytics , $google_remarketing_gtag , $pos ,0 );
						$remarketing_analytics=1;
					}
				}
			}
			if ($google_ecommerce_gtag != ""){
				$pos=strpos($google_analytics , "gtag('config'");
				if ($pos!==false){
					$pos=strpos($google_analytics , "</script>",$pos);
					if ($pos!==false) {
						$google_analytics = substr_replace ( $google_analytics , $google_ecommerce_gtag , $pos ,0 );
						$remarketing_analytics=1;
					}
				}
			}
			if ($google_global_tag != "") { //gtag merge
				$start=strpos($google_adwords_code , "gtag('config");
				$end=strpos($google_adwords_code , "');");
				if ($start!==false && $end!==false) {
					$google_adwords_code=substr($google_adwords_code , $start ,$end-$start+3);
				}
				$pos=strripos($google_analytics , "</script>");
				if ($pos!==false){
					$google_analytics = substr_replace ( $google_analytics , $google_adwords_code.$google_global_tag , $pos ,0 );
					$remarketing_analytics=1;
				}
			}
		}
		if (strpos($google_analytics, 'ga(')!==false ){
			$google_remarketing_ga = $this->document->getRemarketingGoogleGA();
			$google_ecommerce_ga = $this->document->getEcommerceGoogleGA();
			if ($google_remarketing_ga != ""){
				$pos=strpos ($google_analytics , "ga('send'");
				if ($pos!==false) {
					$google_analytics = substr_replace ( $google_analytics , $google_remarketing_ga , $pos ,0 );
				}
			}
			if ($google_ecommerce_ga != ""){
				$pos=strpos ($google_analytics , "ga('send'");
				if ($pos!==false) {
					$google_analytics = substr_replace ( $google_analytics , $google_ecommerce_ga , $pos ,0 );
				}
			}
		}
		array_push($data['analytics'], html_entity_decode($google_analytics , ENT_QUOTES, 'UTF-8'));
	}
]]></add>
	</operation>
</file>

<file path="catalog/controller/common/header.php">
	<operation>	<!--     Remarketing/Ecommerce    -->
		<search><![CDATA['home']]></search>
		<add position="before"><![CDATA[
	if ($remarketing_analytics==0 && $google_global_tag != ""){
		$pos=strripos ($google_adwords_code , "</script>");
		if ($pos!==false) {
			$google_adwords_code = substr_replace ( $google_adwords_code , $google_global_tag , $pos ,0 );
		}
		$data['google_adwords_code'] = html_entity_decode($google_adwords_code, ENT_QUOTES, 'UTF-8');
	}
	if (!isset($data['google_legacy_code'])){ //legacy code only
		$data['google_legacy_code'] = "";
	}
	if ($google_remarketing_tag != "") { //legacy code only
		$data['google_legacy_code'] = html_entity_decode($data['google_legacy_code'].$google_remarketing_tag, ENT_QUOTES, 'UTF-8');
	}
	if ($google_conversion_code != "") { //legacy code only
		$data['google_legacy_code'] = html_entity_decode($data['google_legacy_code'].$google_conversion_code, ENT_QUOTES, 'UTF-8');
	}
]]></add>
	</operation>
</file>

<file path="catalog/controller/common/header.php">
	<operation error="skip">	<!--     Remarketing/Ecommerce   oc<2031  -->
		<search><![CDATA[$this->config->get('config_google_analytics')]]></search>
		<add position="after"><![CDATA[
		$google_analytics=$data['google_analytics'];
		if (strpos($google_analytics, 'gtag(')!==false ){
			$google_remarketing_gtag = $this->document->getRemarketingGoogleGTAG();
			$google_ecommerce_gtag = $this->document->getEcommerceGoogleGTAG();
			if ($google_remarketing_gtag != ""){
				$pos=strpos($google_analytics , "gtag('config'");
				if ($pos!==false){
					$pos=strpos($google_analytics , ");",$pos);
					if ($pos!==false) {
						$google_analytics = substr_replace ( $google_analytics , $google_remarketing_gtag , $pos ,0 );
						$remarketing_analytics=1;
					}
				}
			}
			if ($google_ecommerce_gtag != ""){
				$pos=strpos($google_analytics , "gtag('config'");
				if ($pos!==false){
					$pos=strpos($google_analytics , "</script>",$pos);
					if ($pos!==false) {
						$google_analytics = substr_replace ( $google_analytics , $google_ecommerce_gtag , $pos ,0 );
						$remarketing_analytics=1;
					}
				}
			}
			if ($google_global_tag != "") {
				$start=strpos($google_adwords_code , "gtag('config");
				$end=strpos($google_adwords_code , "');");
				if ($start!==false && $end!==false) {
					$google_adwords_code=substr($google_adwords_code , $start ,$end-$start+3);
				}
				$pos=strripos($google_analytics , "</script>");
				if ($pos!==false){
					$google_analytics = substr_replace ( $google_analytics , $google_adwords_code.$google_global_tag , $pos ,0 );
					$remarketing_analytics=1;
				}
			}
		}
		if (strpos($google_analytics, 'ga(')!==false ){
			$google_remarketing_ga = $this->document->getRemarketingGoogleGA();
			$google_ecommerce_ga = $this->document->getEcommerceGoogleGA();
			if ($google_remarketing_ga != ""){
				$pos=strpos ($google_analytics , "ga('send'");
				if ($pos!==false) {
					$google_analytics = substr_replace ( $google_analytics , $google_remarketing_ga , $pos ,0 );
				}
			}
			if ($google_ecommerce_ga != ""){
				$pos=strpos ($google_analytics , "ga('send'");
				if ($pos!==false) {
					$google_analytics = substr_replace ( $google_analytics , $google_ecommerce_ga , $pos ,0 );
				}
			}
		}
		$data['google_analytics'] = html_entity_decode($google_analytics , ENT_QUOTES, 'UTF-8');
]]></add>
	</operation>
</file>

<file path="catalog/model/catalog/category.php">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA[extends]]></search>
		<add position="after"><![CDATA[
	public function setGoogleTag($remarketing_id_1,$remarketing_id_2,$price,$page_type_retail,$page_type_custom,$prefix,$postfix) {
		$google_remarketing_tag = html_entity_decode($this->config->get('config_remarketing_manager_google_snippet'), ENT_QUOTES, 'UTF-8');
		$facebook_remarketing_id = '';
		$remarketingGA = '';
		$remarketingGTAG = '';
		if ($prefix!="'" && $remarketing_id_2=="")
			$remarketing_id_2="''";
		if ($this->config->get('config_remarketing_manager_analytics_status')==1) {
			$dynx_itemid=$this->config->get('config_remarketing_manager_id1_index');
			$dynx_itemid2=$this->config->get('config_remarketing_manager_id2_index');
			$dynx_pagetype=$this->config->get('config_remarketing_manager_pagetype_index');
			$dynx_totalvalue=$this->config->get('config_remarketing_manager_totalvalue_index');
			//old ga
			if ($dynx_itemid != "")
			$remarketingGA = $remarketingGA.'ga(\'set\',\'dimension'.$dynx_itemid.'\','.$prefix.$remarketing_id_1.$postfix.');
';
			if ($dynx_itemid2 != "" && $remarketing_id_2 != "")
				$remarketingGA = $remarketingGA.'ga(\'set\',\'dimension'.$dynx_itemid2.'\','.$prefix.$remarketing_id_2.$postfix.');
';
			if ($dynx_pagetype != "")
				$remarketingGA = $remarketingGA.'ga(\'set\',\'dimension'.$dynx_pagetype.'\',\''.$page_type_custom.'\');
';
			if ($dynx_totalvalue != "" && $price!="")
				$remarketingGA = $remarketingGA.'ga(\'set\',\'dimension'.$dynx_totalvalue.'\',\''.$price.'\');
';
		 //new gtag
			$remarketingGTAG = ", { 'custom_map': { ";
			if ($dynx_itemid != "")
				$remarketingGTAG = $remarketingGTAG."'dimension".$dynx_itemid."': 'dynx_itemid'";
			if ($dynx_itemid2 != "" && $remarketing_id_2 != "")
				$remarketingGTAG = $remarketingGTAG.",'dimension".$dynx_itemid2."': 'dynx_itemid2'";
			if ($dynx_pagetype != "")
				$remarketingGTAG = $remarketingGTAG.",'dimension".$dynx_pagetype."': 'dynx_pagetype'";
			if ($dynx_totalvalue != "" && $price!="")
				$remarketingGTAG = $remarketingGTAG.",'dimension".$dynx_totalvalue."': 'dynx_totalvalue'";
			$remarketingGTAG = $remarketingGTAG."}});
gtag('event', 'remarketing', {";
			if ($dynx_itemid != "")
				$remarketingGTAG = $remarketingGTAG."'dynx_itemid': ".$prefix.$remarketing_id_1.$postfix;
			if ($dynx_itemid2 != "" && $remarketing_id_2 != "")
				$remarketingGTAG = $remarketingGTAG.",'dynx_itemid2': ".$prefix.$remarketing_id_2.$postfix;
			if ($dynx_pagetype != "")
				$remarketingGTAG = $remarketingGTAG.",'dynx_pagetype': '".$page_type_custom."'";
			if ($dynx_totalvalue != "" && $price!="")
				$remarketingGTAG = $remarketingGTAG.",'dynx_totalvalue': '".$price."'";
			$remarketingGTAG = $remarketingGTAG."}";
		}
		if (strpos($google_remarketing_tag, 'gtag')!==false){ // new gtag
			if (strpos($google_remarketing_tag, 'ecomm_prodid')!==false){
				$google_remarketing_tag = str_replace('ecomm_prodid\': \'replace with value\'','ecomm_prodid\': '.$prefix.$remarketing_id_1.$postfix,$google_remarketing_tag);
				$google_remarketing_tag = str_replace('ecomm_pagetype\': \'replace with value\'','ecomm_pagetype\': \''.$page_type_retail.'\'',$google_remarketing_tag);
				$google_remarketing_tag = str_replace('ecomm_totalvalue\': \'replace with value\'','ecomm_totalvalue\': '.$price,$google_remarketing_tag);
				if ($price==""){
					$google_remarketing_tag = str_replace('\'ecomm_totalvalue\': ,','',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('\'ecomm_totalvalue\': ','',$google_remarketing_tag);
				}
			}
			if (strpos($google_remarketing_tag, 'dynx_itemid')!==false){
				$google_remarketing_tag = str_replace('dynx_itemid\': \'replace with value\'','dynx_itemid\': '.$prefix.$remarketing_id_1.$postfix,$google_remarketing_tag);
				$google_remarketing_tag = str_replace('dynx_itemid2\': \'replace with value\'','dynx_itemid2\': '.$prefix.$remarketing_id_2.$postfix,$google_remarketing_tag);
				$google_remarketing_tag = str_replace('dynx_pagetype\': \'replace with value\'','dynx_pagetype\': \''.$page_type_custom.'\'',$google_remarketing_tag);
				$google_remarketing_tag = str_replace('dynx_totalvalue\': \'replace with value\'','dynx_totalvalue\': '.$price,$google_remarketing_tag);
				if ($price=="") {
					$google_remarketing_tag = str_replace('\'dynx_totalvalue\': ,','',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('\'dynx_totalvalue\': ','',$google_remarketing_tag);
				}
			}
			$google_remarketing_tag = str_replace('replace with value','',$google_remarketing_tag);
		} else { //legacy adwords
			if (strpos($google_remarketing_tag, 'ecomm_prodid')!==false){
				$google_remarketing_tag = str_replace('ecomm_prodid: \'REPLACE_WITH_VALUE\'','ecomm_prodid: '.$prefix.$remarketing_id_1.$postfix,$google_remarketing_tag);
				$google_remarketing_tag = str_replace('ecomm_pagetype: \'REPLACE_WITH_VALUE\'','ecomm_pagetype: \''.$page_type_retail.'\'',$google_remarketing_tag);
				$google_remarketing_tag = str_replace('ecomm_totalvalue: \'REPLACE_WITH_VALUE\'','ecomm_totalvalue: '.$price,$google_remarketing_tag);
				if ($price==""){
					$google_remarketing_tag = str_replace('ecomm_totalvalue: ,','',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('ecomm_totalvalue: ','',$google_remarketing_tag);
				}
			}
			if (strpos($google_remarketing_tag, 'dynx_itemid')!==false){
				$google_remarketing_tag = str_replace('dynx_itemid: \'REPLACE_WITH_VALUE\'','dynx_itemid: '.$prefix.$remarketing_id_1.$postfix,$google_remarketing_tag);
				$google_remarketing_tag = str_replace('dynx_itemid2: \'REPLACE_WITH_VALUE\'','dynx_itemid2: '.$prefix.$remarketing_id_2.$postfix,$google_remarketing_tag);
				$google_remarketing_tag = str_replace('dynx_pagetype: \'REPLACE_WITH_VALUE\'','dynx_pagetype: \''.$page_type_custom.'\'',$google_remarketing_tag);
				$google_remarketing_tag = str_replace('dynx_totalvalue: \'REPLACE_WITH_VALUE\'','dynx_totalvalue: '.$price,$google_remarketing_tag);
				if ($price=="") {
					$google_remarketing_tag = str_replace('dynx_totalvalue: ,','',$google_remarketing_tag);
					$google_remarketing_tag = str_replace('dynx_totalvalue: ','',$google_remarketing_tag);
				}
			}
			$google_remarketing_tag = str_replace('REPLACE_WITH_VALUE','',$google_remarketing_tag);
		}
		$this->document->setRemarketingGoogleGA(html_entity_decode($remarketingGA, ENT_QUOTES, 'UTF-8'));
		$this->document->setRemarketingGoogleGTAG(html_entity_decode($remarketingGTAG, ENT_QUOTES, 'UTF-8'));
		$this->document->setRemarketingGoogleTag(html_entity_decode($google_remarketing_tag, ENT_QUOTES, 'UTF-8'));
	}

	public function setFacebookPixel($facebook_remarketing_id,$remarketing_price,$event,$content_name,$content_type,$items_count) {
		$facebook_remarketing_tag = $this->config->get('config_remarketing_manager_facebook_code');
		$fb_quote = '&quot;';
		if (strpos($facebook_remarketing_tag, "PageView'")!==false){
			$fb_quote = "'";
		}
		if (strpos($facebook_remarketing_tag, "PageView")!==false){
			$num_items="";
			if ($num_items!="")
				$num_items='num_items: '.$items_count.',
';
			$fb_dynamic = $event.$fb_quote.', {
content_name: \''.$content_name.'\',
content_ids: ['.$facebook_remarketing_id.'],
content_type: \''.$content_type.'\',
'.$num_items.'value: '.$remarketing_price.',
currency: \''.$this->session->data['currency'].'\'
});';
			$facebook_remarketing_tag = str_replace('PageView'.$fb_quote.');','PageView'.$fb_quote.');fbq('.$fb_quote.'track'.$fb_quote.', '.$fb_quote.''.$fb_dynamic,$facebook_remarketing_tag);
		}
		$this->document->setRemarketingFacebook(html_entity_decode($facebook_remarketing_tag, ENT_QUOTES, 'UTF-8'));
	}
]]></add>
	</operation>
</file>

<file path="catalog/controller/common/header.php">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA[$data['name'] = $this->config->get('config_name');]]></search>
		<add position="before"><![CDATA[
	$facebook_remarketing_tag = $this->document->getRemarketingFacebook();
	if ($facebook_remarketing_tag == "")
		$facebook_remarketing_tag = $this->config->get('config_remarketing_manager_facebook_code');
	if ($facebook_remarketing_tag != ""){
		$facebook_remarketing_advanced = $this->config->get('config_remarketing_manager_facebook_advanced');
		if ($facebook_remarketing_advanced == 1) {
			$contains_matching_start=strpos($facebook_remarketing_tag, "init");
			$contains_matching_end=strpos($facebook_remarketing_tag, ");", $contains_matching_start);
			$contains_matching=substr ($facebook_remarketing_tag, $contains_matching_start, ($contains_matching_end-$contains_matching_start));
			if (strpos ($contains_matching , "{")===false)
				$facebook_remarketing_tag=substr_replace ( $facebook_remarketing_tag , ", {}", $contains_matching_end, 0 );
			$customer_email='';
			$customer_firstname='';
			$customer_lastname='';
			if ($this->customer->isLogged()){
				$customer_email = strtolower ($this->customer->getEmail());
				$customer_firstname = strtolower ($this->customer->getFirstName());
				$customer_lastname = strtolower ($this->customer->getLastName());
			} elseif (isset($this->session->data['guest'])){
				if (isset($this->session->data['guest']['email'])) {
						$customer_email = $this->session->data['guest']['email'];
				}
				if (isset($this->session->data['guest']['firstname'])) {
						$customer_firstname = $this->session->data['guest']['firstname'];
				}
				if (isset($this->session->data['guest']['lastname'])) {
						$customer_lastname = $this->session->data['guest']['lastname'];
				}
			}
			$customer_email=str_replace(' ', '', strtolower($customer_email));
			if ($customer_email!='') {
				$pos=strpos ($facebook_remarketing_tag , "em:");
				if ($pos !== false) {
					$posEOL=strpos ($facebook_remarketing_tag , PHP_EOL, $pos);
					if ($posEOL !== false) {
						if (substr ( $facebook_remarketing_tag , $posEOL-2, 1 )==';'){
							$posEOL=strpos ($facebook_remarketing_tag , ',', $pos);
							if ($posEOL !== false)
								$posEOL=$posEOL+1;
						}
						if ($posEOL !== false)
							$facebook_remarketing_tag=substr_replace ( $facebook_remarketing_tag , "em: '".$customer_email."'," , $pos ,($posEOL-$pos) );
					}
				} else {
					$pos=strpos ($facebook_remarketing_tag , "});");
					if ($pos !== false)
						$facebook_remarketing_tag=substr_replace ( $facebook_remarketing_tag , "em: '".$customer_email."',".PHP_EOL , $pos ,0 );
				}
			}
			if ($customer_firstname!='') {
				$pos=strpos ($facebook_remarketing_tag , "fn:");
				if ($pos !== false) {
					$posEOL=strpos ($facebook_remarketing_tag , PHP_EOL, $pos);
					if ($posEOL !== false) {
						if (substr ( $facebook_remarketing_tag , $posEOL-2, 1 )==';'){
							$posEOL=strpos ($facebook_remarketing_tag , ',', $pos);
							if ($posEOL !== false)
								$posEOL=$posEOL+1;
						}
						if ($posEOL !== false)
							$facebook_remarketing_tag=substr_replace ( $facebook_remarketing_tag , "fn: '".$customer_firstname."'," , $pos ,($posEOL-$pos) );
					}
				} else {
					$pos=strpos ($facebook_remarketing_tag , "});");
					if ($pos !== false)
						$facebook_remarketing_tag=substr_replace ( $facebook_remarketing_tag , "fn: '".$customer_firstname."',".PHP_EOL , $pos ,0 );
				}
			}
			if ($customer_lastname!='') {
				$pos=strpos ($facebook_remarketing_tag , "ln:");
				if ($pos !== false) {
					$posEOL=strpos ($facebook_remarketing_tag , PHP_EOL, $pos);
					if ($posEOL !== false) {
						if (substr ( $facebook_remarketing_tag , $posEOL-2, 1 )==';'){
							$posEOL=strpos ($facebook_remarketing_tag , ',', $pos);
							if ($posEOL !== false)
								$posEOL=$posEOL+1;
						}
						if ($posEOL !== false)
							$facebook_remarketing_tag=substr_replace ( $facebook_remarketing_tag , "ln: '".$customer_lastname."'," , $pos ,($posEOL-$pos) );
					}
				} else {
					$pos=strpos ($facebook_remarketing_tag , "});");
					if ($pos !== false)
						$facebook_remarketing_tag=substr_replace ( $facebook_remarketing_tag , "ln: '".$customer_lastname."',".PHP_EOL , $pos ,0 );
				}
			}
		}
		$facebook_remarketing_tag = str_replace('insert_email_variable,','',$facebook_remarketing_tag);
		$facebook_remarketing_tag = str_replace('insert_email_variable','',$facebook_remarketing_tag);
		$data['facebook_remarketing'] = html_entity_decode($facebook_remarketing_tag, ENT_QUOTES, 'UTF-8');
	}
]]></add>
	</operation>
</file>

<file path="admin/controller/setting/store.php">
	<operation>	<!-- Remarketing -->
		<search><![CDATA[$data['tab_server'] = $this->language->get('tab_server');]]></search>
		<add position="before"><![CDATA[
	$this->language->load('setting/remarketing');
	$data['tab_remarketing'] = $this->language->get('tab_remarketing');
	$data['entry_google_remarketing_analytics'] = $this->language->get('entry_google_remarketing_analytics');
	$data['entry_remarketing_pagetype_index'] = $this->language->get('entry_remarketing_pagetype_index');
	$data['entry_remarketing_id1_index'] = $this->language->get('entry_remarketing_id1_index');
	$data['entry_remarketing_id2_index'] = $this->language->get('entry_remarketing_id2_index');
	$data['entry_remarketing_totalvalue_index'] = $this->language->get('entry_remarketing_totalvalue_index');
	$data['entry_google_adwords_code'] = $this->language->get('entry_google_adwords_code');
	$data['entry_google_remarketing_snippet'] = $this->language->get('entry_google_remarketing_snippet');
	$data['entry_google_remarketing_id1'] = $this->language->get('entry_google_remarketing_id1');
	$data['entry_google_remarketing_id2'] = $this->language->get('entry_google_remarketing_id2');
	$data['entry_google_remarketing_random'] = $this->language->get('entry_google_remarketing_random');
	$data['entry_facebook_remarketing_code'] = $this->language->get('entry_facebook_remarketing_code');
	$data['entry_facebook_remarketing_id'] = $this->language->get('entry_facebook_remarketing_id');
	$data['entry_facebook_remarketing_advanced'] = $this->language->get('entry_facebook_remarketing_advanced');

	$data['text_google_remarketing_code'] = $this->language->get('text_google_remarketing_code');
	$data['text_google_remarketing_analytics'] = $this->language->get('text_google_remarketing_analytics');
	$data['text_facebook_remarketing_code'] = $this->language->get('text_facebook_remarketing_code');

	$data['help_google_adwords_code'] = $this->language->get('help_google_adwords_code');
	$data['help_google_remarketing_snippet'] = $this->language->get('help_google_remarketing_snippet');
	$data['help_google_remarketing_id1'] = $this->language->get('help_google_remarketing_id1');
	$data['help_google_remarketing_id2'] = $this->language->get('help_google_remarketing_id2');
	$data['help_google_remarketing_random'] = $this->language->get('help_google_remarketing_random');
	$data['help_remarketing_id1_index'] = $this->language->get('help_remarketing_id1_index');
	$data['help_remarketing_id2_index'] = $this->language->get('help_remarketing_id2_index');
	$data['help_remarketing_pagetype_index'] = $this->language->get('help_remarketing_pagetype_index');
	$data['help_remarketing_totalvalue_index'] = $this->language->get('help_remarketing_totalvalue_index');
	$data['help_google_remarketing_analytics'] = $this->language->get('help_google_remarketing_analytics');
	$data['help_google_remarketing_analytics_status'] = $this->language->get('help_google_remarketing_analytics_status');

	$data['help_facebook_remarketing_id'] = $this->language->get('help_facebook_remarketing_id');
	$data['help_facebook_remarketing_code'] = $this->language->get('help_facebook_remarketing_code');
	$data['help_facebook_remarketing_advanced'] = $this->language->get('help_facebook_remarketing_advanced');
]]></add>
	</operation>
</file>

<file path="admin/controller/setting/setting.php">
	<operation>	<!-- Remarketing -->
		<search><![CDATA[$data['tab_server'] = $this->language->get('tab_server');]]></search>
		<add position="before"><![CDATA[
	$this->language->load('setting/remarketing');
	$data['tab_remarketing'] = $this->language->get('tab_remarketing');
	$data['entry_google_remarketing_analytics'] = $this->language->get('entry_google_remarketing_analytics');
	$data['entry_remarketing_pagetype_index'] = $this->language->get('entry_remarketing_pagetype_index');
	$data['entry_remarketing_id1_index'] = $this->language->get('entry_remarketing_id1_index');
	$data['entry_remarketing_id2_index'] = $this->language->get('entry_remarketing_id2_index');
	$data['entry_remarketing_totalvalue_index'] = $this->language->get('entry_remarketing_totalvalue_index');
	$data['entry_google_adwords_code'] = $this->language->get('entry_google_adwords_code');
	$data['entry_google_remarketing_snippet'] = $this->language->get('entry_google_remarketing_snippet');
	$data['entry_google_remarketing_id1'] = $this->language->get('entry_google_remarketing_id1');
	$data['entry_google_remarketing_id2'] = $this->language->get('entry_google_remarketing_id2');
	$data['entry_google_remarketing_random'] = $this->language->get('entry_google_remarketing_random');
	$data['entry_facebook_remarketing_code'] = $this->language->get('entry_facebook_remarketing_code');
	$data['entry_facebook_remarketing_id'] = $this->language->get('entry_facebook_remarketing_id');
	$data['entry_facebook_remarketing_advanced'] = $this->language->get('entry_facebook_remarketing_advanced');

	$data['text_google_remarketing_code'] = $this->language->get('text_google_remarketing_code');
	$data['text_google_remarketing_analytics'] = $this->language->get('text_google_remarketing_analytics');
	$data['text_facebook_remarketing_code'] = $this->language->get('text_facebook_remarketing_code');

	$data['help_google_adwords_code'] = $this->language->get('help_google_adwords_code');
	$data['help_google_remarketing_snippet'] = $this->language->get('help_google_remarketing_snippet');
	$data['help_google_remarketing_id1'] = $this->language->get('help_google_remarketing_id1');
	$data['help_google_remarketing_id2'] = $this->language->get('help_google_remarketing_id2');
	$data['help_google_remarketing_random'] = $this->language->get('help_google_remarketing_random');
	$data['help_remarketing_id1_index'] = $this->language->get('help_remarketing_id1_index');
	$data['help_remarketing_id2_index'] = $this->language->get('help_remarketing_id2_index');
	$data['help_remarketing_pagetype_index'] = $this->language->get('help_remarketing_pagetype_index');
	$data['help_remarketing_totalvalue_index'] = $this->language->get('help_remarketing_totalvalue_index');
	$data['help_google_remarketing_analytics'] = $this->language->get('help_google_remarketing_analytics');
	$data['help_google_remarketing_analytics_status'] = $this->language->get('help_google_remarketing_analytics_status');

	$data['help_facebook_remarketing_id'] = $this->language->get('help_facebook_remarketing_id');
	$data['help_facebook_remarketing_code'] = $this->language->get('help_facebook_remarketing_code');
	$data['help_facebook_remarketing_advanced'] = $this->language->get('help_facebook_remarketing_advanced');
]]></add>
	</operation>
</file>

<file path="admin/controller/setting/setting.php">
	<operation>	<!-- Remarketing-->
		<search><![CDATA[$this->model_localisation_language->getLanguages();]]></search>
		<add position="after"><![CDATA[
	if (isset($this->request->post['config_remarketing_manager_analytics_status'])) {
		$data['config_remarketing_manager_analytics_status'] = $this->request->post['config_remarketing_manager_analytics_status'];
	} elseif ($this->config->get('config_remarketing_manager_analytics_status')) {
		$data['config_remarketing_manager_analytics_status'] = $this->config->get('config_remarketing_manager_analytics_status');
	} else {
		$data['config_remarketing_manager_analytics_status'] = 0;
	}
	if (isset($this->request->post['config_remarketing_manager_random_status'])) {
		$data['config_remarketing_manager_random_status'] = $this->request->post['config_remarketing_manager_random_status'];
	} elseif ($this->config->get('config_remarketing_manager_random_status')) {
		$data['config_remarketing_manager_random_status'] = $this->config->get('config_remarketing_manager_random_status');
	} else {
		$data['config_remarketing_manager_random_status'] = 0;
	}
	if (isset($this->request->post['config_remarketing_manager_id1_index'])) {
		$data['config_remarketing_manager_id1_index'] = $this->request->post['config_remarketing_manager_id1_index'];
	} elseif ($this->config->get('config_remarketing_manager_id1_index')!='') {
		$data['config_remarketing_manager_id1_index'] = $this->config->get('config_remarketing_manager_id1_index');
	} else {
		$data['config_remarketing_manager_id1_index'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_id2_index'])) {
		$data['config_remarketing_manager_id2_index'] = $this->request->post['config_remarketing_manager_id2_index'];
	} elseif ($this->config->get('config_remarketing_manager_id2_index')!='') {
		$data['config_remarketing_manager_id2_index'] = $this->config->get('config_remarketing_manager_id2_index');
	} else {
		$data['config_remarketing_manager_id2_index'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_pagetype_index'])) {
		$data['config_remarketing_manager_pagetype_index'] = $this->request->post['config_remarketing_manager_pagetype_index'];
	} elseif ($this->config->get('config_remarketing_manager_pagetype_index')!='') {
		$data['config_remarketing_manager_pagetype_index'] = $this->config->get('config_remarketing_manager_pagetype_index');
	} else {
		$data['config_remarketing_manager_pagetype_index'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_totalvalue_index'])) {
		$data['config_remarketing_manager_totalvalue_index'] = $this->request->post['config_remarketing_manager_totalvalue_index'];
	} elseif ($this->config->get('config_remarketing_manager_totalvalue_index')!='') {
		$data['config_remarketing_manager_totalvalue_index'] = $this->config->get('config_remarketing_manager_totalvalue_index');
	} else {
		$data['config_remarketing_manager_totalvalue_index'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_adwords_code'])) {
		$data['config_remarketing_manager_adwords_code'] = $this->request->post['config_remarketing_manager_adwords_code'];
	} elseif ($this->config->get('config_remarketing_manager_adwords_code')!='') {
		$data['config_remarketing_manager_adwords_code'] = $this->config->get('config_remarketing_manager_adwords_code');
	} else {
		$data['config_remarketing_manager_adwords_code'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_google_snippet'])) {
		$data['config_remarketing_manager_google_snippet'] = $this->request->post['config_remarketing_manager_google_snippet'];
	} elseif ($this->config->get('config_remarketing_manager_google_snippet')!='') {
		$data['config_remarketing_manager_google_snippet'] = html_entity_decode($this->config->get('config_remarketing_manager_google_snippet'), ENT_QUOTES, 'UTF-8');
	} else {
		$data['config_remarketing_manager_google_snippet'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_google_id1'])) {
		$data['config_remarketing_manager_google_id1'] = $this->request->post['config_remarketing_manager_google_id1'];
	} elseif ($this->config->get('config_remarketing_manager_google_id1')!='') {
		$data['config_remarketing_manager_google_id1'] = $this->config->get('config_remarketing_manager_google_id1');
	} else {
		$data['config_remarketing_manager_google_id1'] = 'product_id';
	}
	if (isset($this->request->post['config_remarketing_manager_google_id2'])) {
		$data['config_remarketing_manager_google_id2'] = $this->request->post['config_remarketing_manager_google_id2'];
	} elseif ($this->config->get('config_remarketing_manager_google_id2')!='') {
		$data['config_remarketing_manager_google_id2'] = $this->config->get('config_remarketing_manager_google_id2');
	} else {
		$data['config_remarketing_manager_google_id2'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_facebook_code'])) {
		$data['config_remarketing_manager_facebook_code'] = $this->request->post['config_remarketing_manager_facebook_code'];
	} elseif ($this->config->get('config_remarketing_manager_facebook_code')!='') {
		$data['config_remarketing_manager_facebook_code'] = $this->config->get('config_remarketing_manager_facebook_code');
	} else {
		$data['config_remarketing_manager_facebook_code'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_facebook_id'])) {
		$data['config_remarketing_manager_facebook_id'] = $this->request->post['config_remarketing_manager_facebook_id'];
	} elseif ($this->config->get('config_remarketing_manager_facebook_id')!='') {
		$data['config_remarketing_manager_facebook_id'] = $this->config->get('config_remarketing_manager_facebook_id');
	} else {
		$data['config_remarketing_manager_facebook_id'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_facebook_advanced'])) {
		$data['config_remarketing_manager_facebook_advanced'] = $this->request->post['config_remarketing_manager_facebook_advanced'];
	} elseif ($this->config->get('config_remarketing_manager_facebook_advanced')) {
		$data['config_remarketing_manager_facebook_advanced'] = $this->config->get('config_remarketing_manager_facebook_advanced');
	} else {
		$data['config_remarketing_manager_facebook_advanced'] = 0;
	}
]]></add>
	</operation>
</file>

<file path="admin/controller/setting/store.php">
	<operation>	<!-- Remarketing-->
		<search><![CDATA[$this->model_localisation_language->getLanguages();]]></search>
		<add position="after"><![CDATA[
	if (isset($this->request->post['config_remarketing_manager_analytics_status'])) {
		$data['config_remarketing_manager_analytics_status'] = $this->request->post['config_remarketing_manager_analytics_status'];
	} elseif (isset($store_info['config_remarketing_manager_analytics_status'])) {
		$data['config_remarketing_manager_analytics_status'] = $store_info['config_remarketing_manager_analytics_status'];
	} else {
		$data['config_remarketing_manager_analytics_status'] = 0;
	}
	if (isset($this->request->post['config_remarketing_manager_random_status'])) {
		$data['config_remarketing_manager_random_status'] = $this->request->post['config_remarketing_manager_random_status'];
	} elseif (isset($store_info['config_remarketing_manager_random_status'])) {
		$data['config_remarketing_manager_random_status'] = $store_info['config_remarketing_manager_random_status'];
	} else {
		$data['config_remarketing_manager_random_status'] = 0;
	}
	if (isset($this->request->post['config_remarketing_manager_id1_index'])) {
		$data['config_remarketing_manager_id1_index'] = $this->request->post['config_remarketing_manager_id1_index'];
	} elseif (isset($store_info['config_remarketing_manager_id1_index'])) {
		$data['config_remarketing_manager_id1_index'] = $store_info['config_remarketing_manager_id1_index'];
	} else {
		$data['config_remarketing_manager_id1_index'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_id2_index'])) {
		$data['config_remarketing_manager_id2_index'] = $this->request->post['config_remarketing_manager_id2_index'];
	} elseif (isset($store_info['config_remarketing_manager_id2_index'])) {
		$data['config_remarketing_manager_id2_index'] = $store_info['config_remarketing_manager_id2_index'];
	} else {
		$data['config_remarketing_manager_id2_index'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_pagetype_index'])) {
		$data['config_remarketing_manager_pagetype_index'] = $this->request->post['config_remarketing_manager_pagetype_index'];
	} elseif (isset($store_info['config_remarketing_manager_pagetype_index'])) {
		$data['config_remarketing_manager_pagetype_index'] = $store_info['config_remarketing_manager_pagetype_index'];
	} else {
		$data['config_remarketing_manager_pagetype_index'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_totalvalue_index'])) {
		$data['config_remarketing_manager_totalvalue_index'] = $this->request->post['config_remarketing_manager_totalvalue_index'];
	} elseif (isset($store_info['config_remarketing_manager_totalvalue_index'])) {
		$data['config_remarketing_manager_totalvalue_index'] = $store_info['config_remarketing_manager_totalvalue_index'];
	} else {
		$data['config_remarketing_manager_totalvalue_index'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_adwords_code'])) {
		$data['config_remarketing_manager_adwords_code'] = $this->request->post['config_remarketing_manager_adwords_code'];
	} elseif (isset($store_info['config_remarketing_manager_adwords_code'])) {
		$data['config_remarketing_manager_adwords_code'] = $store_info['config_remarketing_manager_adwords_code'];
	} else {
		$data['config_remarketing_manager_adwords_code'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_google_snippet'])) {
		$data['config_remarketing_manager_google_snippet'] = $this->request->post['config_remarketing_manager_google_snippet'];
	} elseif (isset($store_info['config_remarketing_manager_google_snippet'])) {
		$data['config_remarketing_manager_google_snippet'] = $store_info['config_remarketing_manager_google_snippet'];
	} else {
		$data['config_remarketing_manager_google_snippet'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_google_id1'])) {
		$data['config_remarketing_manager_google_id1'] = $this->request->post['config_remarketing_manager_google_id1'];
	} elseif (isset($store_info['config_remarketing_manager_google_id1'])) {
		$data['config_remarketing_manager_google_id1'] = $store_info['config_remarketing_manager_google_id1'];
	} else {
		$data['config_remarketing_manager_google_id1'] = 'product_id';
	}
	if (isset($this->request->post['config_remarketing_manager_google_id2'])) {
		$data['config_remarketing_manager_google_id2'] = $this->request->post['config_remarketing_manager_google_id2'];
	} elseif (isset($store_info['config_remarketing_manager_google_id2'])) {
		$data['config_remarketing_manager_google_id2'] = $store_info['config_remarketing_manager_google_id2'];
	} else {
		$data['config_remarketing_manager_google_id2'] = '';
	}
	if (isset($this->request->post['config_google_analytics'])) {
		$data['config_google_analytics'] = $this->request->post['config_google_analytics'];
	} elseif (isset($store_info['config_google_analytics'])) {
		$data['config_google_analytics'] = $store_info['config_google_analytics'];
	} else {
		$data['config_google_analytics']='';
	}
	if (isset($this->request->post['config_remarketing_manager_facebook_code'])) {
		$data['config_remarketing_manager_facebook_code'] = $this->request->post['config_remarketing_manager_facebook_code'];
	} elseif (isset($store_info['config_remarketing_manager_facebook_code'])) {
		$data['config_remarketing_manager_facebook_code'] = $store_info['config_remarketing_manager_facebook_code'];
	} else {
		$data['config_remarketing_manager_facebook_code'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_facebook_id'])) {
		$data['config_remarketing_manager_facebook_id'] = $this->request->post['config_remarketing_manager_facebook_id'];
	} elseif (isset($store_info['config_remarketing_manager_facebook_id'])) {
		$data['config_remarketing_manager_facebook_id'] = $store_info['config_remarketing_manager_facebook_id'];
	} else {
		$data['config_remarketing_manager_facebook_id'] = '';
	}
	if (isset($this->request->post['config_remarketing_manager_facebook_advanced'])) {
		$data['config_remarketing_manager_facebook_advanced'] = $this->request->post['config_remarketing_manager_facebook_advanced'];
	} elseif (isset($store_info['config_remarketing_manager_facebook_advanced'])) {
		$data['config_remarketing_manager_facebook_advanced'] = $store_info['config_remarketing_manager_facebook_advanced'];
	} else {
		$data['config_remarketing_manager_facebook_advanced'] = 0;
	}
]]></add>
	</operation>
</file>

<file path="admin/view/template/setting/store_form.tpl">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA["#tab-server"]]></search>
		<add position="before"><![CDATA[<li><a href="#tab-remarketing" data-toggle="tab"><?php echo $tab_remarketing; ?></a></li>]]></add>
	</operation>

	<operation>	<!--     Remarketing     -->
		<search><![CDATA[id="tab-server"]]></search>
		<add position="before"><![CDATA[
	<div class="tab-pane" id="tab-remarketing">
		<fieldset>
			<legend><?php echo $text_google_remarketing_code; ?></legend>
			<div class="alert alert-info"><?php echo $help_google_adwords_code; ?></div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-adwords-code"><?php echo $entry_google_adwords_code; ?></label>
				<div class="col-sm-10">
					<textarea name="config_remarketing_manager_adwords_code" rows="5" placeholder="<?php echo $entry_google_adwords_code; ?>" id="input-google-adwords-code" class="form-control"><?php echo $config_remarketing_manager_adwords_code; ?></textarea>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-remarketing-snippet"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_remarketing_snippet); ?>"><?php echo $entry_google_remarketing_snippet; ?></span></label>
				<div class="col-sm-10">
					<textarea name="config_remarketing_manager_google_snippet" rows="5" placeholder="<?php echo $entry_google_remarketing_snippet; ?>" id="input-google-remarketing-snippet" class="form-control"><?php echo $config_remarketing_manager_google_snippet; ?></textarea>
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-remarketing-id1"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_remarketing_id1); ?>"><?php echo $entry_google_remarketing_id1; ?></span></label>
				<div class="col-sm-10">
					<select name="config_remarketing_manager_google_id1" id="input-google-remarketing-id1" class="form-control">
						<?php if ($config_remarketing_manager_google_id1 == 'model') { ?>
							<option value="model" selected="selected"><?php echo 'model'; ?></option>
							<option value="product_id"><?php echo 'product_id'; ?></option>
						<?php } else { ?>
							<option value="product_id" selected="selected"><?php echo 'product_id'; ?></option>
							<option value="model"><?php echo 'model'; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-remarketing-random"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_remarketing_random); ?>"><?php echo $entry_google_remarketing_random; ?></span></label>
				<div class="col-sm-10">
					<select name="config_remarketing_manager_random_status" id="input-google-remarketing-random" class="form-control">
						<?php if ($config_remarketing_manager_random_status) { ?>
							<option value="1" selected="selected"><?php echo $text_enabled; ?></option>
							<option value="0"><?php echo $text_disabled; ?></option>
						<?php } else { ?>
							<option value="1"><?php echo $text_enabled; ?></option>
							<option value="0" selected="selected"><?php echo $text_disabled; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>
		</fieldset>

		<fieldset>
			<legend><?php echo $text_google_remarketing_analytics; ?></legend>
			<div class="alert alert-info"><?php echo $help_google_remarketing_analytics; ?></div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-remarketing-analytics"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_remarketing_analytics_status); ?>"><?php echo $entry_google_remarketing_analytics; ?></span></label>
				<div class="col-sm-10">
					<select name="config_remarketing_manager_analytics_status" id="input-google-remarketing-analytics" class="form-control">
						<?php if ($config_remarketing_manager_analytics_status) { ?>
							<option value="1" selected="selected"><?php echo $text_enabled; ?></option>
							<option value="0"><?php echo $text_disabled; ?></option>
						<?php } else { ?>
							<option value="1"><?php echo $text_enabled; ?></option>
							<option value="0" selected="selected"><?php echo $text_disabled; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>
			<div class="remarketing_analytics_index">
				<div class="form-group">
					<label class="col-sm-2 control-label" for="input-google-remarketing-id2"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_remarketing_id2); ?>"><?php echo $entry_google_remarketing_id2; ?></span></label>
					<div class="col-sm-10">
						<select name="config_remarketing_manager_google_id2" id="input-google-remarketing-id2" class="form-control">
							<?php if ($config_remarketing_manager_google_id2 == '') { ?>
								<option value="" selected="selected"><?php echo ''; ?></option>
								<option value="model"><?php echo 'model'; ?></option>
								<option value="product_id"><?php echo 'product_id'; ?></option>
							<?php } elseif ($config_remarketing_manager_google_id2 == 'model') { ?>
								<option value=""><?php echo ''; ?></option>
								<option value="model" selected="selected"><?php echo 'model'; ?></option>
								<option value="product_id"><?php echo 'product_id'; ?></option>
							<?php } else { ?>
								<option value=""><?php echo ''; ?></option>
								<option value="model"><?php echo 'model'; ?></option>
								<option value="product_id" selected="selected"><?php echo 'product_id'; ?></option>
							<?php } ?>
						</select>
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label" for="input-remarketing-id1-index"><span data-toggle="tooltip" title="<?php echo $help_remarketing_id1_index; ?>"><?php echo $entry_remarketing_id1_index; ?></span></label>
					<div class="col-sm-10">
						<input type="text" name="config_remarketing_manager_id1_index" value="<?php echo $config_remarketing_manager_id1_index; ?>" placeholder="<?php echo $entry_remarketing_id1_index; ?>" id="input-remarketing-id1-index" class="form-control" />
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label" for="input-remarketing-id2-index"><span data-toggle="tooltip" title="<?php echo $help_remarketing_id2_index; ?>"><?php echo $entry_remarketing_id2_index; ?></span></label>
					<div class="col-sm-10">
						<input type="text" name="config_remarketing_manager_id2_index" value="<?php echo $config_remarketing_manager_id2_index; ?>" placeholder="<?php echo $entry_remarketing_id2_index; ?>" id="input-remarketing-id2-index" class="form-control" />
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label" for="input-remarketing-pagetype-index"><span data-toggle="tooltip" title="<?php echo $help_remarketing_pagetype_index; ?>"><?php echo $entry_remarketing_pagetype_index; ?></span></label>
					<div class="col-sm-10">
						<input type="text" name="config_remarketing_manager_pagetype_index" value="<?php echo $config_remarketing_manager_pagetype_index; ?>" placeholder="<?php echo $entry_remarketing_pagetype_index; ?>" id="input-remarketing-pagetype-index" class="form-control" />
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label" for="input-remarketing-totalvalue-index"><span data-toggle="tooltip" title="<?php echo $help_remarketing_totalvalue_index; ?>"><?php echo $entry_remarketing_totalvalue_index; ?></span></label>
					<div class="col-sm-10">
						<input type="text" name="config_remarketing_manager_totalvalue_index" value="<?php echo $config_remarketing_manager_totalvalue_index; ?>" placeholder="<?php echo $entry_remarketing_totalvalue_index; ?>" id="input-remarketing-totalvalue-index" class="form-control" />
					</div>
				</div>

			</div>
		</fieldset>

		<fieldset>
			<legend><?php echo $text_facebook_remarketing_code; ?></legend>
			<div class="alert alert-info"><?php echo $help_facebook_remarketing_code; ?></div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-facebook-remarketing-code"><?php echo $entry_facebook_remarketing_code; ?></label>
				<div class="col-sm-10">
					<textarea name="config_remarketing_manager_facebook_code" rows="5" placeholder="<?php echo $entry_facebook_remarketing_code; ?>" id="input-facebook-remarketing-code" class="form-control"><?php echo $config_remarketing_manager_facebook_code; ?></textarea>
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-facebook-remarketing-id"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_facebook_remarketing_id); ?>"><?php echo $entry_facebook_remarketing_id; ?></span></label>
				<div class="col-sm-10">
					<select name="config_remarketing_manager_facebook_id" id="input-facebook-remarketing-id" class="form-control">
						<?php if ($config_remarketing_manager_facebook_id == 'model') { ?>
							<option value="model" selected="selected"><?php echo 'model'; ?></option>
							<option value="product_id"><?php echo 'product_id'; ?></option>
						<?php } else { ?>
							<option value="product_id" selected="selected"><?php echo 'product_id'; ?></option>
							<option value="model"><?php echo 'model'; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-facebook-remarketing-advanced"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_facebook_remarketing_advanced); ?>"><?php echo $entry_facebook_remarketing_advanced; ?></span></label>
				<div class="col-sm-10">
					<select name="config_remarketing_manager_facebook_advanced" id="input-facebook-remarketing-advanced" class="form-control">
						<?php if ($config_remarketing_manager_facebook_advanced) { ?>
							<option value="1" selected="selected"><?php echo $text_enabled; ?></option>
							<option value="0"><?php echo $text_disabled; ?></option>
						<?php } else { ?>
							<option value="1"><?php echo $text_enabled; ?></option>
							<option value="0" selected="selected"><?php echo $text_disabled; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>

		</fieldset>
		<script type="text/javascript">
		$(document).ready(function(){
			$('select[name="config_remarketing_manager_analytics_status"]').change(function(){
				if($(this).val()=="1"){
					$(".remarketing_analytics_index").show();
				} else {
					$(".remarketing_analytics_index").hide();
				}
			});

			if($('select[name="config_remarketing_manager_analytics_status"]').val()=="1"){
				$(".remarketing_analytics_index").show();
			}
			else {
				$(".remarketing_analytics_index").hide();
			}
		});
		</script>
	</div>
]]></add>
	</operation>
</file>


<file path="admin/view/template/setting/setting.tpl">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA["#tab-server"]]></search>
		<add position="before"><![CDATA[<li><a href="#tab-remarketing" data-toggle="tab"><?php echo $tab_remarketing; ?></a></li>]]></add>
	</operation>

	<operation>	<!--     Remarketing     -->
		<search><![CDATA[id="tab-server"]]></search>
		<add position="before"><![CDATA[
	<div class="tab-pane" id="tab-remarketing">
		<fieldset>
			<legend><?php echo $text_google_remarketing_code; ?></legend>
			<div class="alert alert-info"><?php echo $help_google_adwords_code; ?></div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-adwords-code"><?php echo $entry_google_adwords_code; ?></label>
				<div class="col-sm-10">
					<textarea name="config_remarketing_manager_adwords_code" rows="5" placeholder="<?php echo $entry_google_adwords_code; ?>" id="input-google-adwords-code" class="form-control"><?php echo $config_remarketing_manager_adwords_code; ?></textarea>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-remarketing-snippet"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_remarketing_snippet); ?>"><?php echo $entry_google_remarketing_snippet; ?></span></label>
				<div class="col-sm-10">
					<textarea name="config_remarketing_manager_google_snippet" rows="5" placeholder="<?php echo $entry_google_remarketing_snippet; ?>" id="input-google-remarketing-snippet" class="form-control"><?php echo $config_remarketing_manager_google_snippet; ?></textarea>
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-remarketing-id1"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_remarketing_id1); ?>"><?php echo $entry_google_remarketing_id1; ?></span></label>
				<div class="col-sm-10">
					<select name="config_remarketing_manager_google_id1" id="input-google-remarketing-id1" class="form-control">
						<?php if ($config_remarketing_manager_google_id1 == 'model') { ?>
							<option value="model" selected="selected"><?php echo 'model'; ?></option>
							<option value="product_id"><?php echo 'product_id'; ?></option>
						<?php } else { ?>
							<option value="product_id" selected="selected"><?php echo 'product_id'; ?></option>
							<option value="model"><?php echo 'model'; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-remarketing-random"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_remarketing_random); ?>"><?php echo $entry_google_remarketing_random; ?></span></label>
				<div class="col-sm-10">
					<select name="config_remarketing_manager_random_status" id="input-google-remarketing-random" class="form-control">
						<?php if ($config_remarketing_manager_random_status) { ?>
							<option value="1" selected="selected"><?php echo $text_enabled; ?></option>
							<option value="0"><?php echo $text_disabled; ?></option>
						<?php } else { ?>
							<option value="1"><?php echo $text_enabled; ?></option>
							<option value="0" selected="selected"><?php echo $text_disabled; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>
		</fieldset>

		<fieldset>
			<legend><?php echo $text_google_remarketing_analytics; ?></legend>
			<div class="alert alert-info"><?php echo $help_google_remarketing_analytics; ?></div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-remarketing-analytics"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_remarketing_analytics_status); ?>"><?php echo $entry_google_remarketing_analytics; ?></span></label>
				<div class="col-sm-10">
					<select name="config_remarketing_manager_analytics_status" id="input-google-remarketing-analytics" class="form-control">
						<?php if ($config_remarketing_manager_analytics_status) { ?>
							<option value="1" selected="selected"><?php echo $text_enabled; ?></option>
							<option value="0"><?php echo $text_disabled; ?></option>
						<?php } else { ?>
							<option value="1"><?php echo $text_enabled; ?></option>
							<option value="0" selected="selected"><?php echo $text_disabled; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>
			<div class="remarketing_analytics_index">
				<div class="form-group">
					<label class="col-sm-2 control-label" for="input-google-remarketing-id2"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_remarketing_id2); ?>"><?php echo $entry_google_remarketing_id2; ?></span></label>
					<div class="col-sm-10">
						<select name="config_remarketing_manager_google_id2" id="input-google-remarketing-id2" class="form-control">
							<?php if ($config_remarketing_manager_google_id2 == '') { ?>
								<option value="" selected="selected"><?php echo ''; ?></option>
								<option value="model"><?php echo 'model'; ?></option>
								<option value="product_id"><?php echo 'product_id'; ?></option>
							<?php } elseif ($config_remarketing_manager_google_id2 == 'model') { ?>
								<option value=""><?php echo ''; ?></option>
								<option value="model" selected="selected"><?php echo 'model'; ?></option>
								<option value="product_id"><?php echo 'product_id'; ?></option>
							<?php } else { ?>
								<option value=""><?php echo ''; ?></option>
								<option value="model"><?php echo 'model'; ?></option>
								<option value="product_id" selected="selected"><?php echo 'product_id'; ?></option>
							<?php } ?>
						</select>
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label" for="input-remarketing-id1-index"><span data-toggle="tooltip" title="<?php echo $help_remarketing_id1_index; ?>"><?php echo $entry_remarketing_id1_index; ?></span></label>
					<div class="col-sm-10">
						<input type="text" name="config_remarketing_manager_id1_index" value="<?php echo $config_remarketing_manager_id1_index; ?>" placeholder="<?php echo $entry_remarketing_id1_index; ?>" id="input-remarketing-id1-index" class="form-control" />
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label" for="input-remarketing-id2-index"><span data-toggle="tooltip" title="<?php echo $help_remarketing_id2_index; ?>"><?php echo $entry_remarketing_id2_index; ?></span></label>
					<div class="col-sm-10">
						<input type="text" name="config_remarketing_manager_id2_index" value="<?php echo $config_remarketing_manager_id2_index; ?>" placeholder="<?php echo $entry_remarketing_id2_index; ?>" id="input-remarketing-id2-index" class="form-control" />
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label" for="input-remarketing-pagetype-index"><span data-toggle="tooltip" title="<?php echo $help_remarketing_pagetype_index; ?>"><?php echo $entry_remarketing_pagetype_index; ?></span></label>
					<div class="col-sm-10">
						<input type="text" name="config_remarketing_manager_pagetype_index" value="<?php echo $config_remarketing_manager_pagetype_index; ?>" placeholder="<?php echo $entry_remarketing_pagetype_index; ?>" id="input-remarketing-pagetype-index" class="form-control" />
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label" for="input-remarketing-totalvalue-index"><span data-toggle="tooltip" title="<?php echo $help_remarketing_totalvalue_index; ?>"><?php echo $entry_remarketing_totalvalue_index; ?></span></label>
					<div class="col-sm-10">
						<input type="text" name="config_remarketing_manager_totalvalue_index" value="<?php echo $config_remarketing_manager_totalvalue_index; ?>" placeholder="<?php echo $entry_remarketing_totalvalue_index; ?>" id="input-remarketing-totalvalue-index" class="form-control" />
					</div>
				</div>

			</div>
		</fieldset>

		<fieldset>
			<legend><?php echo $text_facebook_remarketing_code; ?></legend>
			<div class="alert alert-info"><?php echo $help_facebook_remarketing_code; ?></div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-facebook-remarketing-code"><?php echo $entry_facebook_remarketing_code; ?></label>
				<div class="col-sm-10">
					<textarea name="config_remarketing_manager_facebook_code" rows="5" placeholder="<?php echo $entry_facebook_remarketing_code; ?>" id="input-facebook-remarketing-code" class="form-control"><?php echo $config_remarketing_manager_facebook_code; ?></textarea>
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-facebook-remarketing-id"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_facebook_remarketing_id); ?>"><?php echo $entry_facebook_remarketing_id; ?></span></label>
				<div class="col-sm-10">
					<select name="config_remarketing_manager_facebook_id" id="input-facebook-remarketing-id" class="form-control">
						<?php if ($config_remarketing_manager_facebook_id == 'model') { ?>
							<option value="model" selected="selected"><?php echo 'model'; ?></option>
							<option value="product_id"><?php echo 'product_id'; ?></option>
						<?php } else { ?>
							<option value="product_id" selected="selected"><?php echo 'product_id'; ?></option>
							<option value="model"><?php echo 'model'; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-facebook-remarketing-advanced"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_facebook_remarketing_advanced); ?>"><?php echo $entry_facebook_remarketing_advanced; ?></span></label>
				<div class="col-sm-10">
					<select name="config_remarketing_manager_facebook_advanced" id="input-facebook-remarketing-advanced" class="form-control">
						<?php if ($config_remarketing_manager_facebook_advanced) { ?>
							<option value="1" selected="selected"><?php echo $text_enabled; ?></option>
							<option value="0"><?php echo $text_disabled; ?></option>
						<?php } else { ?>
							<option value="1"><?php echo $text_enabled; ?></option>
							<option value="0" selected="selected"><?php echo $text_disabled; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>

		</fieldset>
		<script type="text/javascript">
		$(document).ready(function(){
			$('select[name="config_remarketing_manager_analytics_status"]').change(function(){
				if($(this).val()=="1"){
					$(".remarketing_analytics_index").show();
				} else {
					$(".remarketing_analytics_index").hide();
				}
			});

			if($('select[name="config_remarketing_manager_analytics_status"]').val()=="1"){
				$(".remarketing_analytics_index").show();
			}
			else {
				$(".remarketing_analytics_index").hide();
			}
		});
		</script>
	</div>
]]></add>
	</operation>
</file>

<file path="catalog/controller/product/product.php">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA[$data['options']]]></search>
		<add position="before"><![CDATA[
	$remarketing_price='';
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
		$remarketing_id_1 = $data['product_id'];
	else
		$remarketing_id_1 = str_replace(',','',$data['model']);
	if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
		$remarketing_id_2 = $data['product_id'];
	elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
		$remarketing_id_2 = str_replace(',','',$data['model']);
	if ($remarketing_id_1==$remarketing_id_2)
		$remarketing_id_2='';
	if ((float)$product_info['special']) {
		$remarketing_price = $this->currency->format($this->tax->calculate($product_info['special'], $product_info['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency'],'',false);
	} elseif(($this->config->get('config_customer_price') && $this->customer->isLogged()) || !$this->config->get('config_customer_price')) {
		$remarketing_price = $this->currency->format($this->tax->calculate($product_info['price'], $product_info['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false);
	} else {
		$remarketing_price = '0';
	}
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"product","offerdetail","'","'");

	$product_title=str_replace('&quot;', '',str_replace('&apos;', '',str_replace('"', '',str_replace("'", "",$data['heading_title']))));
	$facebook_remarketing_id = '';
	if ($this->config->get('config_remarketing_manager_facebook_id')=='product_id')
		$facebook_remarketing_id = $data['product_id'];
	else
		$facebook_remarketing_id = str_replace(',','',$data['model']);
	$facebook_remarketing_id ="'".$facebook_remarketing_id."'";
	$this->model_catalog_category->setFacebookPixel($facebook_remarketing_id,$remarketing_price,"ViewContent",$product_title,"product","");
]]></add>
	</operation>
</file>

<file path="catalog/controller/product/product.php">
	<operation>   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[function index]]></search>
			<add position="after"><![CDATA[
	if ($this->config->get('config_remarketing_manager_cart_button')!='') {
		$cart_button_id = $this->config->get('config_remarketing_manager_cart_button');
		if (substr($cart_button_id, 0, 1) === '#' || substr($cart_button_id, 0, 1) === '.')
			$cart_button_id = '#'.$cart_button_id;
		$data['config_remarketing_manager_cart_button'] = $cart_button_id;
	} else {
		$data['config_remarketing_manager_cart_button'] = '#button-cart';
	}
]]></add>
	</operation>
</file>

<file path="catalog/view/theme/*/template/product/product.tpl">
	<operation>   <!--  Remarketing Facebook AddToCart   -->
		<search index="0"><![CDATA[footer]]></search>
		<add position="before"><![CDATA[ <script type="text/javascript">$('<?php echo $config_remarketing_manager_cart_button; ?>').on('click', function () {
	setTimeout( function () {
		addButtonChecker.AddToCartProduct('<?php echo $product_id; ?>', '<?php echo $minimum; ?>');
	}, 0 );
 });</script>]]></add>
	</operation>
</file>

<file path="catalog/view/theme/*/template/product/product.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[cart.add]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');cart.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/product/category.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[cart.add]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');cart.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/product/special.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[cart.add]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');cart.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/product/search.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[cart.add]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');cart.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/product/manufacturer_info.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[cart.add]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');cart.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/module/bestseller.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[cart.add]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');cart.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/module/special.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[cart.add]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');cart.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/module/featured.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[cart.add]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');cart.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/module/latest.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[cart.add]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');cart.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/extension/module/bestseller.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[cart.add]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');cart.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/extension/module/special.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[cart.add]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');cart.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/extension/module/featured.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[cart.add]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');cart.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/extension/module/latest.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[cart.add]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');cart.add]]></add>
	</operation>
</file>

<file path="catalog/view/theme/*/template/product/product.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[ajaxAdd]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');ajaxAdd]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/product/category.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[ajaxAdd]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');ajaxAdd]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/product/special.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[ajaxAdd]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');ajaxAdd]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/product/search.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[ajaxAdd]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');ajaxAdd]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/product/manufacturer_info.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[ajaxAdd]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');ajaxAdd]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/module/bestseller.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[ajaxAdd]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');ajaxAdd]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/module/special.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[ajaxAdd]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');ajaxAdd]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/module/featured.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[ajaxAdd]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');ajaxAdd]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/module/latest.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[ajaxAdd]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');ajaxAdd]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/extension/module/bestseller.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[ajaxAdd]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');ajaxAdd]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/extension/module/special.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[ajaxAdd]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');ajaxAdd]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/extension/module/featured.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[ajaxAdd]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');ajaxAdd]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/extension/module/latest.tpl">
	<operation error="skip">   <!--  Remarketing Facebook AddToCart   -->
		<search><![CDATA[ajaxAdd]]></search>
		<add position="replace"><![CDATA[addButtonChecker.AddToCart('<?php echo $product['product_id']; ?>', '<?php if (isset($product['minimum'])) echo $product['minimum']; else echo "1"; ?>');ajaxAdd]]></add>
	</operation>
</file>

<file path="catalog/view/theme/*/template/product/product.tpl">
	<operation error="skip"> <!--     Remarketing Facebook WishList   -->
		<search><![CDATA[wishlist.add]]></search>
		<add position="replace"><![CDATA[<?php if (isset($product['product_id'])) $wishlist_product_id=$product['product_id']; else $wishlist_product_id=$product_id; ?>addButtonChecker.AddToWishlist('<?php echo $wishlist_product_id; ?>');wishlist.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/product/category.tpl">
	<operation error="skip"> <!--     Remarketing Facebook WishList   -->
		<search><![CDATA[wishlist.add]]></search>
		<add position="replace"><![CDATA[<?php if (isset($product['product_id'])) $wishlist_product_id=$product['product_id']; else $wishlist_product_id=$product_id; ?>addButtonChecker.AddToWishlist('<?php echo $wishlist_product_id; ?>');wishlist.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/product/special.tpl">
	<operation error="skip"> <!--     Remarketing Facebook WishList   -->
		<search><![CDATA[wishlist.add]]></search>
		<add position="replace"><![CDATA[<?php if (isset($product['product_id'])) $wishlist_product_id=$product['product_id']; else $wishlist_product_id=$product_id; ?>addButtonChecker.AddToWishlist('<?php echo $wishlist_product_id; ?>');wishlist.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/product/search.tpl">
	<operation error="skip"> <!--     Remarketing Facebook WishList   -->
		<search><![CDATA[wishlist.add]]></search>
		<add position="replace"><![CDATA[<?php if (isset($product['product_id'])) $wishlist_product_id=$product['product_id']; else $wishlist_product_id=$product_id; ?>addButtonChecker.AddToWishlist('<?php echo $wishlist_product_id; ?>');wishlist.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/product/manufacturer_info.tpl">
	<operation error="skip"> <!--     Remarketing Facebook WishList   -->
		<search><![CDATA[wishlist.add]]></search>
		<add position="replace"><![CDATA[<?php if (isset($product['product_id'])) $wishlist_product_id=$product['product_id']; else $wishlist_product_id=$product_id; ?>addButtonChecker.AddToWishlist('<?php echo $wishlist_product_id; ?>');wishlist.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/module/bestseller.tpl">
	<operation error="skip"> <!--     Remarketing Facebook WishList   -->
		<search><![CDATA[wishlist.add]]></search>
		<add position="replace"><![CDATA[<?php if (isset($product['product_id'])) $wishlist_product_id=$product['product_id']; else $wishlist_product_id=$product_id; ?>addButtonChecker.AddToWishlist('<?php echo $wishlist_product_id; ?>');wishlist.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/module/special.tpl">
	<operation error="skip"> <!--     Remarketing Facebook WishList   -->
		<search><![CDATA[wishlist.add]]></search>
		<add position="replace"><![CDATA[<?php if (isset($product['product_id'])) $wishlist_product_id=$product['product_id']; else $wishlist_product_id=$product_id; ?>addButtonChecker.AddToWishlist('<?php echo $wishlist_product_id; ?>');wishlist.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/module/featured.tpl">
	<operation error="skip"> <!--     Remarketing Facebook WishList   -->
		<search><![CDATA[wishlist.add]]></search>
		<add position="replace"><![CDATA[<?php if (isset($product['product_id'])) $wishlist_product_id=$product['product_id']; else $wishlist_product_id=$product_id; ?>addButtonChecker.AddToWishlist('<?php echo $wishlist_product_id; ?>');wishlist.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/module/latest.tpl">
	<operation error="skip"> <!--     Remarketing Facebook WishList   -->
		<search><![CDATA[wishlist.add]]></search>
		<add position="replace"><![CDATA[<?php if (isset($product['product_id'])) $wishlist_product_id=$product['product_id']; else $wishlist_product_id=$product_id; ?>addButtonChecker.AddToWishlist('<?php echo $wishlist_product_id; ?>');wishlist.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/extension/module/bestseller.tpl">
	<operation error="skip"> <!--     Remarketing Facebook WishList   -->
		<search><![CDATA[wishlist.add]]></search>
		<add position="replace"><![CDATA[<?php if (isset($product['product_id'])) $wishlist_product_id=$product['product_id']; else $wishlist_product_id=$product_id; ?>addButtonChecker.AddToWishlist('<?php echo $wishlist_product_id; ?>');wishlist.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/extension/module/special.tpl">
	<operation error="skip"> <!--     Remarketing Facebook WishList   -->
		<search><![CDATA[wishlist.add]]></search>
		<add position="replace"><![CDATA[<?php if (isset($product['product_id'])) $wishlist_product_id=$product['product_id']; else $wishlist_product_id=$product_id; ?>addButtonChecker.AddToWishlist('<?php echo $wishlist_product_id; ?>');wishlist.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/extension/module/featured.tpl">
	<operation error="skip"> <!--     Remarketing Facebook WishList   -->
		<search><![CDATA[wishlist.add]]></search>
		<add position="replace"><![CDATA[<?php if (isset($product['product_id'])) $wishlist_product_id=$product['product_id']; else $wishlist_product_id=$product_id; ?>addButtonChecker.AddToWishlist('<?php echo $wishlist_product_id; ?>');wishlist.add]]></add>
	</operation>
</file>
<file path="catalog/view/theme/*/template/extension/module/latest.tpl">
	<operation error="skip"> <!--     Remarketing Facebook WishList   -->
		<search><![CDATA[wishlist.add]]></search>
		<add position="replace"><![CDATA[<?php if (isset($product['product_id'])) $wishlist_product_id=$product['product_id']; else $wishlist_product_id=$product_id; ?>addButtonChecker.AddToWishlist('<?php echo $wishlist_product_id; ?>');wishlist.add]]></add>
	</operation>
</file>

<file path="catalog/view/theme/*/template/common/header*.tpl">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA[</head>]]></search>
		<add position="before"><![CDATA[<script type="text/javascript">
	var addButtonChecker = {
	'AddToCartProduct': function(product_id, quantity) {
		$.ajax({
			async: false,
			url: 'index.php?route=checkout/cart/checkAddToCart',
			type: 'post',
			data: $('#product input[type=\'text\'], #product input[type=\'hidden\'], #product input[type=\'radio\']:checked, #product input[type=\'checkbox\']:checked, #product select, #product textarea'),
			dataType: 'json',
			success: function(jsonCartCheck) {
				if (jsonCartCheck['AddToCart']!="") {
					(new Function(jsonCartCheck['AddToCart']))()
				}
			}
		});
	},
	'AddToCart': function(product_id, quantity) {
		$.ajax({
			async: false,
			url: 'index.php?route=checkout/cart/checkAddToCart',
			type: 'post',
			data: 'product_id=' + product_id + '&quantity=' + (typeof(quantity) != 'undefined' ? quantity : 1),
			dataType: 'json',
			success: function(jsonCartCheck) {
				if (jsonCartCheck['AddToCart']!="") {
					(new Function(jsonCartCheck['AddToCart']))()
				}
			}
		});
	},
	'AddToWishlist': function(product_id, quantity) {
		$.ajax({
			async: false,
			url: 'index.php?route=checkout/cart/checkAddToWishlist',
			type: 'post',
			data: 'product_id=' + product_id,
			dataType: 'json',
			success: function(jsonWishCheck) {
				if (jsonWishCheck['AddToWishlist']!="") {
					(new Function(jsonWishCheck['AddToWishlist']))()
				}
			}
		});
	}
	}</script>]]></add>
	</operation>
</file>

<file path="catalog/controller/checkout/cart.php">
	<operation>  <!--     Remarketing Facebook AddToCart check   -->
		<search><![CDATA[function add(]]></search>
		<add position="before"><![CDATA[
	public function checkAddToCart() {
		$this->load->language('checkout/cart');
		$jsonCartCheck = array();
		if (isset($this->request->post['product_id'])) {
			$product_id = (int)$this->request->post['product_id'];
		} else {
			$product_id = 0;
		}
		$this->load->model('catalog/product');
		$product_info = $this->model_catalog_product->getProduct($product_id);
		if ($product_info) {
			if (isset($this->request->post['quantity']) && ((int)$this->request->post['quantity'] >= $product_info['minimum'])) {
				$quantity = (int)$this->request->post['quantity'];
			} else {
				$quantity = $product_info['minimum'] ? $product_info['minimum'] : 1;
			}
			if (isset($this->request->post['option'])) {
				$option = array_filter($this->request->post['option']);
			} else {
				$option = array();
			}
			$product_options = $this->model_catalog_product->getProductOptions($this->request->post['product_id']);
			foreach ($product_options as $product_option) {
				if ($product_option['required'] && empty($option[$product_option['product_option_id']])) {
					$jsonCartCheck['error']['option'][$product_option['product_option_id']] = sprintf($this->language->get('error_required'), $product_option['name']);
				}
			}
			if (isset($this->request->post['recurring_id'])) {
				$recurring_id = $this->request->post['recurring_id'];
			} else {
				$recurring_id = 0;
			}
			$recurrings = $this->model_catalog_product->getProfiles($product_info['product_id']);
			if ($recurrings) {
				$recurring_ids = array();
				foreach ($recurrings as $recurring) {
					$recurring_ids[] = $recurring['recurring_id'];
				}
				if (!in_array($recurring_id, $recurring_ids)) {
					$jsonCartCheck['error']['recurring'] = $this->language->get('error_recurring_required');
				}
			}
			if (!$jsonCartCheck) {
				$facebook_remarketing_id = '';
				$remarketing_price='';

				if ((float)$product_info['special']) {
					$remarketing_price = $this->currency->format($this->tax->calculate($product_info['special'], $product_info['tax_class_id'], $this->config->get('config_tax'))*$quantity, $this->session->data['currency'],'',false);
				} elseif(($this->config->get('config_customer_price') && $this->customer->isLogged()) || !$this->config->get('config_customer_price')) {
					$remarketing_price = $this->currency->format($this->tax->calculate($product_info['price'], $product_info['tax_class_id'], $this->config->get('config_tax'))*$quantity,$this->session->data['currency'],'',false);
				} else {
					$remarketing_price = '0';
				}
				$product_title=str_replace('&quot;', '',str_replace('&apos;', '',str_replace('"', '',str_replace("'", "",$product_info['name']))));
				$facebook_remarketing_id = '';
				if ($this->config->get('config_remarketing_manager_facebook_id')=='product_id')
					$facebook_remarketing_id = $product_id;
				else
					$facebook_remarketing_id = str_replace(',','',$product_info['model']);

				$facebook_remarketing_tag = $this->config->get('config_remarketing_manager_facebook_code');
				if ($facebook_remarketing_tag != ""){
					$fb_dynamic = "fbq('track', 'AddToCart', { content_name: '".$product_title."', content_ids: ['".$facebook_remarketing_id."'], content_type: 'product', value: ".$remarketing_price.", currency: '".$this->session->data['currency']."'});";
					$jsonCartCheck['AddToCart'] = html_entity_decode($fb_dynamic, ENT_QUOTES, 'UTF-8');
				} else {
					$jsonCartCheck['AddToCart'] = "";
				}
			} else {
				$jsonCartCheck['AddToCart'] = "";
			}
		}
		$this->response->addHeader('Content-Type: application/json');
		$this->response->setOutput(json_encode($jsonCartCheck));
	}

	public function checkAddToWishlist() {
		$this->load->language('account/wishlist');
		$jsonWishCheck = array();
		if (isset($this->request->post['product_id'])) {
			$product_id = $this->request->post['product_id'];
		} else {
			$product_id = 0;
		}
		$this->load->model('catalog/product');
		$product_info = $this->model_catalog_product->getProduct($product_id);
		if ($product_info) {
			$facebook_remarketing_id = '';
			$remarketing_price='';
			if ((float)$product_info['special']) {
				$remarketing_price = $this->currency->format($this->tax->calculate($product_info['special'], $product_info['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency'],'',false);
			} elseif(($this->config->get('config_customer_price') && $this->customer->isLogged()) || !$this->config->get('config_customer_price')) {
				$remarketing_price = $this->currency->format($this->tax->calculate($product_info['price'], $product_info['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false);
			} else {
				$remarketing_price = '0';
			}
			$product_title=str_replace('&quot;', '',str_replace('&apos;', '',str_replace('"', '',str_replace("'", "",$product_info['name']))));
			$facebook_remarketing_id = '';
			if ($this->config->get('config_remarketing_manager_facebook_id')=='product_id')
				$facebook_remarketing_id = $product_id;
			else
				$facebook_remarketing_id = str_replace(',','',$product_info['model']);
			$facebook_remarketing_tag = $this->config->get('config_remarketing_manager_facebook_code');
			if ($facebook_remarketing_tag != ""){
				$fb_dynamic = "fbq('track', 'AddToWishlist', { content_name: '".$product_title."', content_ids: ['".$facebook_remarketing_id."'], value: ".$remarketing_price.", content_type: 'product', currency: '".$this->session->data['currency']."' });";
				$jsonWishCheck['AddToWishlist'] = html_entity_decode($fb_dynamic, ENT_QUOTES, 'UTF-8');
			} else {
				$jsonWishCheck['AddToWishlist'] = "";
			}
		}
		$this->response->addHeader('Content-Type: application/json');
		$this->response->setOutput(json_encode($jsonWishCheck));
	}
]]></add>
	</operation>
</file>

<file path="catalog/controller/product/category.php">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA['product_id'  => $result['product_id'],]]></search>
		<add position="after"><![CDATA['model'  => str_replace(',','',$result['model']),]]></add>
	</operation>

	<operation>
		<search><![CDATA[$data['products'][] = array(]]></search>
		<add position="replace"><![CDATA[$remarketing_price = '0';
	if ((float)$result['special']) {
		$remarketing_price = $this->currency->format($this->tax->calculate($result['special'], $result['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false);
	} elseif(($this->config->get('config_customer_price') && $this->customer->isLogged()) || !$this->config->get('config_customer_price')) {
		$remarketing_price = $this->currency->format($this->tax->calculate($result['price'], $result['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false);
	}
	$data['products'][] = array(
'remarketing_price'       => $remarketing_price,]]></add>
		</operation>

		<operation>	<!--     Remarketing     -->
			<search><![CDATA[$data['sorts'] = array();]]></search>
				<add position="before"><![CDATA[
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	$remarketing_price='';
	$product_counter=count($data['products'])-1;
	if ($this->config->get('config_remarketing_manager_random_status')==1 && $product_counter>=0){
		$remarketing_product_index=0;
		if ($product_counter>0)
			$remarketing_product_index=rand(0,$product_counter);
		if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
			$remarketing_id_1 = $data['products'][$remarketing_product_index]['product_id'];
		else
			$remarketing_id_1 = $data['products'][$remarketing_product_index]['model'];
		if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
			$remarketing_id_2 = $data['products'][$remarketing_product_index]['product_id'];
		elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
			$remarketing_id_2 = $data['products'][$remarketing_product_index]['model'];
		if ($remarketing_id_1==$remarketing_id_2)
			$remarketing_id_2='';
		$remarketing_price=$data['products'][$remarketing_product_index]['remarketing_price'];
	}
	$this->load->model('catalog/category');//needed by special,manufacturer
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"category","searchresults","'","'");

	$breadcrumbs_category='';
	$breadcrumbs_count = count ($data['breadcrumbs']);
	for ($i=1; $i<$breadcrumbs_count; $i++){
		if ($i==1)
			$breadcrumbs_category=$data['breadcrumbs'][1]['text'];
		else
			$breadcrumbs_category=$breadcrumbs_category.' > '.$data['breadcrumbs'][$i]['text'];
	}
	$facebook_remarketing_tag = $this->config->get('config_remarketing_manager_facebook_code');
	$fb_quote = '&quot;';
	if (strpos($facebook_remarketing_tag, "PageView'")!==false){
		$fb_quote = "'";
	}
	if (strpos($facebook_remarketing_tag, "PageView")!==false){
	$fb_dynamic = 'Search'.$fb_quote.', {
content_category: \''.$breadcrumbs_category.'\'
});';
	$facebook_remarketing_tag = str_replace('PageView'.$fb_quote.');','PageView'.$fb_quote.');fbq('.$fb_quote.'track'.$fb_quote.', '.$fb_quote.''.$fb_dynamic,$facebook_remarketing_tag);
	}
	$this->document->setRemarketingFacebook(html_entity_decode($facebook_remarketing_tag, ENT_QUOTES, 'UTF-8'));
]]></add>
	</operation>
</file>

<file path="catalog/controller/product/special.php">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA['product_id'  => $result['product_id'],]]></search>
		<add position="after"><![CDATA['model'  => str_replace(',','',$result['model']),]]></add>
	</operation>

	<operation>
		<search><![CDATA[$data['products'][] = array(]]></search>
		<add position="replace"><![CDATA[$remarketing_price = '0';
	if ((float)$result['special']) {
		$remarketing_price = $this->currency->format($this->tax->calculate($result['special'], $result['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false);
	} elseif(($this->config->get('config_customer_price') && $this->customer->isLogged()) || !$this->config->get('config_customer_price')) {
		$remarketing_price = $this->currency->format($this->tax->calculate($result['price'], $result['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false);
	}
	$data['products'][] = array(
'remarketing_price'       => $remarketing_price,]]></add>
		</operation>

		<operation>	<!--     Remarketing     -->
			<search><![CDATA[$data['sorts'] = array();]]></search>
				<add position="before"><![CDATA[
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	$remarketing_price='';
	$product_counter=count($data['products'])-1;
	if ($this->config->get('config_remarketing_manager_random_status')==1 && $product_counter>=0){
		$remarketing_product_index=0;
		if ($product_counter>0)
			$remarketing_product_index=rand(0,$product_counter);
		if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
			$remarketing_id_1 = $data['products'][$remarketing_product_index]['product_id'];
		else
			$remarketing_id_1 = $data['products'][$remarketing_product_index]['model'];
		if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
			$remarketing_id_2 = $data['products'][$remarketing_product_index]['product_id'];
		elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
			$remarketing_id_2 = $data['products'][$remarketing_product_index]['model'];
		if ($remarketing_id_1==$remarketing_id_2)
			$remarketing_id_2='';
		$remarketing_price=$data['products'][$remarketing_product_index]['remarketing_price'];
	}
	$this->load->model('catalog/category');//needed by special,manufacturer
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"category","searchresults","'","'");

	$breadcrumbs_category='';
	$breadcrumbs_count = count ($data['breadcrumbs']);
	for ($i=1; $i<$breadcrumbs_count; $i++){
		if ($i==1)
			$breadcrumbs_category=$data['breadcrumbs'][1]['text'];
		else
			$breadcrumbs_category=$breadcrumbs_category.' > '.$data['breadcrumbs'][$i]['text'];
	}
	$facebook_remarketing_tag = $this->config->get('config_remarketing_manager_facebook_code');
	$fb_quote = '&quot;';
	if (strpos($facebook_remarketing_tag, "PageView'")!==false){
		$fb_quote = "'";
	}
	if (strpos($facebook_remarketing_tag, "PageView")!==false){
	$fb_dynamic = 'Search'.$fb_quote.', {
content_category: \''.$breadcrumbs_category.'\'
});';
	$facebook_remarketing_tag = str_replace('PageView'.$fb_quote.');','PageView'.$fb_quote.');fbq('.$fb_quote.'track'.$fb_quote.', '.$fb_quote.''.$fb_dynamic,$facebook_remarketing_tag);
	}
	$this->document->setRemarketingFacebook(html_entity_decode($facebook_remarketing_tag, ENT_QUOTES, 'UTF-8'));
]]></add>
	</operation>
</file>

<file path="catalog/controller/product/manufacturer.php">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA['product_id'  => $result['product_id'],]]></search>
		<add position="after"><![CDATA['model'  => str_replace(',','',$result['model']),]]></add>
	</operation>

	<operation>
		<search><![CDATA[$data['products'][] = array(]]></search>
		<add position="replace"><![CDATA[$remarketing_price = '0';
	if ((float)$result['special']) {
		$remarketing_price = $this->currency->format($this->tax->calculate($result['special'], $result['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false);
	} elseif(($this->config->get('config_customer_price') && $this->customer->isLogged()) || !$this->config->get('config_customer_price')) {
		$remarketing_price = $this->currency->format($this->tax->calculate($result['price'], $result['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false);
	}
	$data['products'][] = array(
'remarketing_price'       => $remarketing_price,]]></add>
		</operation>

		<operation>	<!--     Remarketing     -->
			<search><![CDATA[$data['sorts'] = array();]]></search>
				<add position="before"><![CDATA[
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	$remarketing_price='';
	$product_counter=count($data['products'])-1;
	if ($this->config->get('config_remarketing_manager_random_status')==1 && $product_counter>=0){
		$remarketing_product_index=0;
		if ($product_counter>0)
			$remarketing_product_index=rand(0,$product_counter);
		if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
			$remarketing_id_1 = $data['products'][$remarketing_product_index]['product_id'];
		else
			$remarketing_id_1 = $data['products'][$remarketing_product_index]['model'];
		if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
			$remarketing_id_2 = $data['products'][$remarketing_product_index]['product_id'];
		elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
			$remarketing_id_2 = $data['products'][$remarketing_product_index]['model'];
		if ($remarketing_id_1==$remarketing_id_2)
			$remarketing_id_2='';
		$remarketing_price=$data['products'][$remarketing_product_index]['remarketing_price'];
	}
	$this->load->model('catalog/category');//needed by special,manufacturer
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"category","searchresults","'","'");

	$breadcrumbs_category='';
	$breadcrumbs_count = count ($data['breadcrumbs']);
	for ($i=1; $i<$breadcrumbs_count; $i++){
		if ($i==1)
			$breadcrumbs_category=$data['breadcrumbs'][1]['text'];
		else
			$breadcrumbs_category=$breadcrumbs_category.' > '.$data['breadcrumbs'][$i]['text'];
	}
	$facebook_remarketing_tag = $this->config->get('config_remarketing_manager_facebook_code');
	$fb_quote = '&quot;';
	if (strpos($facebook_remarketing_tag, "PageView'")!==false){
		$fb_quote = "'";
	}
	if (strpos($facebook_remarketing_tag, "PageView")!==false){
	$fb_dynamic = 'Search'.$fb_quote.', {
content_category: \''.$breadcrumbs_category.'\'
});';
	$facebook_remarketing_tag = str_replace('PageView'.$fb_quote.');','PageView'.$fb_quote.');fbq('.$fb_quote.'track'.$fb_quote.', '.$fb_quote.''.$fb_dynamic,$facebook_remarketing_tag);
	}
	$this->document->setRemarketingFacebook(html_entity_decode($facebook_remarketing_tag, ENT_QUOTES, 'UTF-8'));
]]></add>
	</operation>
</file>

<file path="catalog/controller/product/search.php">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA['product_id'  => $result['product_id'],]]></search>
		<add position="after"><![CDATA['model'  => str_replace(',','',$result['model']),]]></add>
	</operation>

	<operation>
		<search><![CDATA[$data['products'][] = array(]]></search>
		<add position="replace"><![CDATA[$remarketing_price = '0';
	if ((float)$result['special']) {
		$remarketing_price = $this->currency->format($this->tax->calculate($result['special'], $result['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false);
	} elseif(($this->config->get('config_customer_price') && $this->customer->isLogged()) || !$this->config->get('config_customer_price')) {
		$remarketing_price = $this->currency->format($this->tax->calculate($result['price'], $result['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false);
	}
	$data['products'][] = array(
'remarketing_price'       => $remarketing_price,]]></add>
	</operation>

	<operation>	<!--     Remarketing     -->
		<search><![CDATA[$data['search'] = $search;]]></search>
		<add position="before"><![CDATA[
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	$remarketing_price='';
	$product_counter=count($data['products'])-1;
	if ($this->config->get('config_remarketing_manager_random_status')==1 && $product_counter>=0){
		$remarketing_product_index=0;
		if ($product_counter>0)
			$remarketing_product_index=rand(0,$product_counter);
		if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
			$remarketing_id_1 = $data['products'][$remarketing_product_index]['product_id'];
		else
			$remarketing_id_1 = $data['products'][$remarketing_product_index]['model'];
		if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
			$remarketing_id_2 = $data['products'][$remarketing_product_index]['product_id'];
		elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
			$remarketing_id_2 = $data['products'][$remarketing_product_index]['model'];
		if ($remarketing_id_1==$remarketing_id_2)
			$remarketing_id_2='';
		$remarketing_price=$data['products'][$remarketing_product_index]['remarketing_price'];
	}
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"searchresults","searchresults","'","'");

	$facebook_remarketing_tag = $this->config->get('config_remarketing_manager_facebook_code');
	$search_string = '';
	if (isset($this->request->get['search']))
		$search_string=$this->request->get['search'];
	$fb_quote = '&quot;';
	if (strpos($facebook_remarketing_tag, "PageView'")!==false){
		$fb_quote = "'";
	}
	if (strpos($facebook_remarketing_tag, "PageView")!==false){
		$fb_dynamic = 'Search'.$fb_quote.', {
search_string:\''.$search_string.'\',
content_category: \'Search\'
});';
		$facebook_remarketing_tag = str_replace('PageView'.$fb_quote.');','PageView'.$fb_quote.');fbq('.$fb_quote.'track'.$fb_quote.', '.$fb_quote.''.$fb_dynamic,$facebook_remarketing_tag);
		if ($search_string == ''){
			$facebook_remarketing_tag = str_replace('search_string:\'\',','',$facebook_remarketing_tag);
		}
	}
	$this->document->setRemarketingFacebook(html_entity_decode($facebook_remarketing_tag, ENT_QUOTES, 'UTF-8'));
]]></add>
	</operation>
</file>

<file path="catalog/controller/checkout/cart.php">
	<operation>
		<search><![CDATA[$data['products'][] = array(]]></search>
		<add position="replace"><![CDATA[$remarketing_price = '0';
	if(($this->config->get('config_customer_price') && $this->customer->isLogged()) || !$this->config->get('config_customer_price')) {
		$remarketing_price = $this->currency->format($this->tax->calculate($product['price'], $product['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false);
	}
	$data['products'][] = array(
'remarketing_price'       => $remarketing_price,]]></add>
	</operation>

	<operation>	<!--     Remarketing     -->
		<search><![CDATA[$data['vouchers'] = array();]]></search>
		<add position="before"><![CDATA[
	$multi_prefix='';
	$multi_postfix='';
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	if (count($data['products'])>1){
		$multi_prefix='[';
		$multi_postfix=']';
	}
	$remarketing_price=0;
	foreach ($data['products'] as $product) {
		if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
			$remarketing_id_1 = $remarketing_id_1.'\''.$product['product_id'].'\',';
		else
			$remarketing_id_1 = $remarketing_id_1.'\''.str_replace(',','',$product['model']).'\',';
		if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
			$remarketing_id_2 = $remarketing_id_2.'\''.$product['product_id'].'\',';
		elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
			$remarketing_id_2 = $remarketing_id_2.'\''.str_replace(',','',$product['model']).'\',';
		if ($remarketing_id_1==$remarketing_id_2)
			$remarketing_id_2='\'\',';
	$remarketing_price = $remarketing_price+(float) $product['remarketing_price']*(float)$product['quantity'];
	}
	$remarketing_id_1=trim($remarketing_id_1, ',');
	$remarketing_id_2=trim($remarketing_id_2, ',');
	$this->load->model('catalog/category');
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"cart","conversionintent",$multi_prefix,$multi_postfix);
]]></add>
	</operation>
	<operation>	<!--     Remarketing     -->
		<search><![CDATA['total'     => $total,]]></search>
		<add position="after"><![CDATA[
'product_id'      => $product['product_id'],
]]></add>
	</operation>
</file>

<file path="catalog/controller/checkout/checkout.php">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA[['heading_title']]]></search>
		<add position="before"><![CDATA[
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	$facebook_remarketing_id = '';
	$remarketing_price=0;
	$multi_prefix='';
	$multi_postfix='';
	if (count($products)>1){
		$multi_prefix='[';
		$multi_postfix=']';
	}
	foreach ($products as $product) {
		if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
			$remarketing_id_1 = $remarketing_id_1.'\''.$product['product_id'].'\',';
		else
			$remarketing_id_1 = $remarketing_id_1.'\''.str_replace(',','',$product['model']).'\',';
		if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
			$remarketing_id_2 = $remarketing_id_2.'\''.$product['product_id'].'\',';
		elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
			$remarketing_id_2 = $remarketing_id_2.'\''.str_replace(',','',$product['model']).'\',';
		if ($remarketing_id_1==$remarketing_id_2)
			$remarketing_id_2='\'\',';
		if ($this->config->get('config_remarketing_manager_facebook_id')=='product_id')
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.$product['product_id'].'\',';
		else
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.str_replace(',','',$product['model']).'\',';
		$remarketing_price = $remarketing_price+(float) $this->currency->format($this->tax->calculate($product['price'], $product['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false)*(float)$product['quantity'];
	}
	$remarketing_id_1=trim($remarketing_id_1, ',');
	$remarketing_id_2=trim($remarketing_id_2, ',');
	$facebook_remarketing_id=trim($facebook_remarketing_id, ',');
	$this->load->model('catalog/category');
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"cart","conversionintent",$multi_prefix,$multi_postfix);
	$this->model_catalog_category->setFacebookPixel($facebook_remarketing_id,$remarketing_price,"InitiateCheckout","Checkout","product",count($products));
]]></add>
	</operation>
</file>

<file path="catalog/controller/journal*/checkout.php">
	<operation error="skip">	<!--     Remarketing     -->
		<search><![CDATA[['heading_title']]]></search>
		<add position="before"><![CDATA[
	$products = $this->cart->getProducts();
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	$facebook_remarketing_id = '';
	$remarketing_price=0;
	$multi_prefix='';
	$multi_postfix='';
	if (count($products)>1){
		$multi_prefix='[';
		$multi_postfix=']';
	}
	foreach ($products as $product) {
		if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
			$remarketing_id_1 = $remarketing_id_1.'\''.$product['product_id'].'\',';
		else
			$remarketing_id_1 = $remarketing_id_1.'\''.str_replace(',','',$product['model']).'\',';
		if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
			$remarketing_id_2 = $remarketing_id_2.'\''.$product['product_id'].'\',';
		elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
			$remarketing_id_2 = $remarketing_id_2.'\''.str_replace(',','',$product['model']).'\',';
		if ($remarketing_id_1==$remarketing_id_2)
			$remarketing_id_2='\'\',';
		if ($this->config->get('config_remarketing_manager_facebook_id')=='product_id')
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.$product['product_id'].'\',';
		else
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.str_replace(',','',$product['model']).'\',';
		$remarketing_price = $remarketing_price+(float) $this->currency->format($this->tax->calculate($product['price'], $product['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false)*(float)$product['quantity'];
	}
	$remarketing_id_1=trim($remarketing_id_1, ',');
	$remarketing_id_2=trim($remarketing_id_2, ',');
	$facebook_remarketing_id=trim($facebook_remarketing_id, ',');
	$this->load->model('catalog/category');
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"cart","conversionintent",$multi_prefix,$multi_postfix);
	$this->model_catalog_category->setFacebookPixel($facebook_remarketing_id,$remarketing_price,"InitiateCheckout","Checkout","product",count($products));
]]></add>
	</operation>
</file>

<file path="catalog/controller/checkout/simplecheckout.php">
	<operation error="skip">	<!--     Remarketing     -->
		<search><![CDATA[ function index ]]></search>
			<add position="after"><![CDATA[
	$products = $this->cart->getProducts();
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	$remarketing_price=0;
	$facebook_remarketing_id = '';
	$multi_prefix='';
	$multi_postfix='';
	if (count($products)>1){
		$multi_prefix='[';
		$multi_postfix=']';
	}
	foreach ($products as $product) {
		if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
			$remarketing_id_1 = $remarketing_id_1.'\''.$product['product_id'].'\',';
		else
			$remarketing_id_1 = $remarketing_id_1.'\''.str_replace(',','',$product['model']).'\',';
		if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
			$remarketing_id_2 = $remarketing_id_2.'\''.$product['product_id'].'\',';
		elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
			$remarketing_id_2 = $remarketing_id_2.'\''.str_replace(',','',$product['model']).'\',';
		if ($remarketing_id_1==$remarketing_id_2)
			$remarketing_id_2='\'\',';
		if ($this->config->get('config_remarketing_manager_facebook_id')=='product_id')
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.$product['product_id'].'\',';
		else
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.str_replace(',','',$product['model']).'\',';
		$remarketing_price = $remarketing_price+(float) $this->currency->format($this->tax->calculate($product['price'], $product['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false)*(float)$product['quantity'];
	}
	$remarketing_id_1=trim($remarketing_id_1, ',');
	$remarketing_id_2=trim($remarketing_id_2, ',');
	$facebook_remarketing_id=trim($facebook_remarketing_id, ',');
	$this->load->model('catalog/category');
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"cart","conversionintent",$multi_prefix,$multi_postfix);
	$this->model_catalog_category->setFacebookPixel($facebook_remarketing_id,$remarketing_price,"InitiateCheckout","Checkout","product",count($products));
]]></add>
	</operation>
</file>

<file path="catalog/controller/onepagecheckout/checkout.php">
	<operation error="skip">	<!--     Remarketing     -->
		<search><![CDATA[ function index ]]></search>
			<add position="after"><![CDATA[
	$products = $this->cart->getProducts();
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	$remarketing_price=0;
	$facebook_remarketing_id = '';
	$multi_prefix='';
	$multi_postfix='';
	if (count($products)>1){
		$multi_prefix='[';
		$multi_postfix=']';
	}
	foreach ($products as $product) {
		if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
			$remarketing_id_1 = $remarketing_id_1.'\''.$product['product_id'].'\',';
		else
			$remarketing_id_1 = $remarketing_id_1.'\''.str_replace(',','',$product['model']).'\',';
		if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
			$remarketing_id_2 = $remarketing_id_2.'\''.$product['product_id'].'\',';
		elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
			$remarketing_id_2 = $remarketing_id_2.'\''.str_replace(',','',$product['model']).'\',';
		if ($remarketing_id_1==$remarketing_id_2)
			$remarketing_id_2='\'\',';
		if ($this->config->get('config_remarketing_manager_facebook_id')=='product_id')
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.$product['product_id'].'\',';
		else
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.str_replace(',','',$product['model']).'\',';
		$remarketing_price = $remarketing_price+(float) $this->currency->format($this->tax->calculate($product['price'], $product['tax_class_id'], $this->config->get('config_tax')),$this->session->data['currency'],'',false)*(float)$product['quantity'];
	}
	$remarketing_id_1=trim($remarketing_id_1, ',');
	$remarketing_id_2=trim($remarketing_id_2, ',');
	$facebook_remarketing_id=trim($facebook_remarketing_id, ',');
	$this->load->model('catalog/category');
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"cart","conversionintent",$multi_prefix,$multi_postfix);
	$this->model_catalog_category->setFacebookPixel($facebook_remarketing_id,$remarketing_price,"InitiateCheckout","Checkout","product",count($products));
]]></add>
	</operation>
</file>

<file path="catalog/controller/checkout/*success*.php">
	<operation error="skip">	<!--     Remarketing     -->
		<search><![CDATA[$this->cart->clear();]]></search>
		<add position="after"><![CDATA[
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	$facebook_remarketing_id = '';
	$remarketing_price=0;
	$google_ecommerce_ga = '';
	$google_ecommerce_gtag = '';
	$ecommerce_products_ga = '';
	$ecommerce_products_gtag = '';

	$this->load->model('checkout/order');
	$order_id=$this->session->data['order_id'];
	$products=$this->model_checkout_order->getCheckoutProducts($order_id);
	$multi_prefix='';
	$multi_postfix='';
	if (count($products)>1){
		$multi_prefix='[';
		$multi_postfix=']';
	}
	$products_price=0;
	foreach ($products as $product) {
		if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
			$remarketing_id_1 = $remarketing_id_1.'\''.$product['product_id'].'\',';
		else
			$remarketing_id_1 = $remarketing_id_1.'\''.$product['model'].'\',';
		if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
			$remarketing_id_2 = $remarketing_id_2.'\''.$product['product_id'].'\',';
		elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
			$remarketing_id_2 = $remarketing_id_2.'\''.$product['model'].'\',';
		if ($remarketing_id_1==$remarketing_id_2)
			$remarketing_id_2='\'\',';
		if ($this->config->get('config_remarketing_manager_facebook_id')=='product_id')
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.$product['product_id'].'\',';
		else
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.$product['model'].'\',';
		$remarketing_price = $remarketing_price+(float)$product['price']*(float)$product['quantity'];
		$products_price=$products_price+(float) $product['price']*(float)$product['quantity'];

//OLD GA
		$ecommerce_products_ga = $ecommerce_products_ga.'ga(\'ecommerce:addItem\', {
\'id\': \''.$order_id.'\',
\'name\': \''.$product['name'].'\',
\'sku\': \''.$product['model'].'\',
\'price\': \''.$product['price'].'\',
\'quantity\': \''.$product['quantity'].'\'
});
';
//NEW GTAG
		$ecommerce_products_gtag = $ecommerce_products_gtag.',
{
"id": "'.$product['model'].'",
"name": "'.$product['name'].'",
"price": \''.$product['price'].'\',
"quantity": '.$product['quantity'].'
}';
	}
	$remarketing_id_1=trim($remarketing_id_1, ',');
	$remarketing_id_2=trim($remarketing_id_2, ',');
	$facebook_remarketing_id=trim($facebook_remarketing_id, ',');

	$this->load->model('catalog/category');
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"purchase","conversion",$multi_prefix,$multi_postfix);
	$this->model_catalog_category->setFacebookPixel($facebook_remarketing_id,$remarketing_price,"Purchase","Purchase","product",count($products));

	if ($this->config->get('config_conversion_manager_ecommerce_status')==1) {
	//OLD GA
		$google_ecommerce_ga = $google_ecommerce_ga.'ga(\'require\', \'ecommerce\');
ga(\'ecommerce:addTransaction\', {
\'id\': \''.$order_id.'\',
\'revenue\': \''.$products_price.'\',
\'currency\': \''.$this->session->data['currency'].'\'
});
';
		$google_ecommerce_ga = $google_ecommerce_ga.$ecommerce_products_ga;
		$google_ecommerce_ga = $google_ecommerce_ga. 'ga(\'ecommerce:send\');
';
		$this->document->setEcommerceGoogleGA(html_entity_decode($google_ecommerce_ga, ENT_QUOTES, 'UTF-8'));
	//NEW GTAG
		$ecommerce_products_gtag=substr_replace ( $ecommerce_products_gtag , "" , 0 ,1 );
		$ecommerce_products_gtag='gtag(\'event\', \'purchase\', {
"transaction_id": "'.$order_id.'",
"value": '.$products_price.',
"currency": "'.$this->session->data['currency'].'",
"items": ['.$ecommerce_products_gtag.']
});';
		$this->document->setEcommerceGoogleGTAG(html_entity_decode($ecommerce_products_gtag, ENT_QUOTES, 'UTF-8'));
	}
]]></add>
	</operation>
</file>

<file path="catalog/controller/onepagecheckout/ordersuccess.php">
	<operation error="skip">	<!--     Remarketing     -->
		<search><![CDATA[$this->cart->clear();]]></search>
		<add position="after"><![CDATA[
	$remarketing_id_1 = '';
	$remarketing_id_2 = '';
	$facebook_remarketing_id = '';
	$remarketing_price=0;
	$google_ecommerce_ga = '';
	$google_ecommerce_gtag = '';
	$ecommerce_products_ga = '';
	$ecommerce_products_gtag = '';

	$this->load->model('checkout/order');
	$order_id=$this->session->data['order_id'];
	$products=$this->model_checkout_order->getCheckoutProducts($order_id);
	$multi_prefix='';
	$multi_postfix='';
	if (count($products)>1){
		$multi_prefix='[';
		$multi_postfix=']';
	}
	$products_price=0;
	foreach ($products as $product) {
		if ($this->config->get('config_remarketing_manager_google_id1')=='product_id')
			$remarketing_id_1 = $remarketing_id_1.'\''.$product['product_id'].'\',';
		else
			$remarketing_id_1 = $remarketing_id_1.'\''.$product['model'].'\',';
		if ($this->config->get('config_remarketing_manager_google_id2')=='product_id')
			$remarketing_id_2 = $remarketing_id_2.'\''.$product['product_id'].'\',';
		elseif ($this->config->get('config_remarketing_manager_google_id2')=='model')
			$remarketing_id_2 = $remarketing_id_2.'\''.$product['model'].'\',';
		if ($remarketing_id_1==$remarketing_id_2)
			$remarketing_id_2='\'\',';
		if ($this->config->get('config_remarketing_manager_facebook_id')=='product_id')
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.$product['product_id'].'\',';
		else
			$facebook_remarketing_id = $facebook_remarketing_id.'\''.$product['model'].'\',';
		$remarketing_price = $remarketing_price+(float)$product['price']*(float)$product['quantity'];
		$products_price=$products_price+(float) $product['price']*(float)$product['quantity'];

//OLD GA
		$ecommerce_products_ga = $ecommerce_products_ga.'ga(\'ecommerce:addItem\', {
\'id\': \''.$order_id.'\',
\'name\': \''.$product['name'].'\',
\'sku\': \''.$product['model'].'\',
\'price\': \''.$product['price'].'\',
\'quantity\': \''.$product['quantity'].'\'
});
';
//NEW GTAG
		$ecommerce_products_gtag = $ecommerce_products_gtag.',
{
"id": "'.$product['model'].'",
"name": "'.$product['name'].'",
"price": \''.$product['price'].'\',
"quantity": '.$product['quantity'].'
}';
	}
	$remarketing_id_1=trim($remarketing_id_1, ',');
	$remarketing_id_2=trim($remarketing_id_2, ',');
	$facebook_remarketing_id=trim($facebook_remarketing_id, ',');

	$this->load->model('catalog/category');
	$this->model_catalog_category->setGoogleTag($remarketing_id_1,$remarketing_id_2,$remarketing_price,"purchase","conversion",$multi_prefix,$multi_postfix);
	$this->model_catalog_category->setFacebookPixel($facebook_remarketing_id,$remarketing_price,"Purchase","Purchase","product",count($products));

	if ($this->config->get('config_conversion_manager_ecommerce_status')==1) {
	//OLD GA
		$google_ecommerce_ga = $google_ecommerce_ga.'ga(\'require\', \'ecommerce\');
ga(\'ecommerce:addTransaction\', {
\'id\': \''.$order_id.'\',
\'revenue\': \''.$products_price.'\',
\'currency\': \''.$this->session->data['currency'].'\'
});
';
		$google_ecommerce_ga = $google_ecommerce_ga.$ecommerce_products_ga;
		$google_ecommerce_ga = $google_ecommerce_ga. 'ga(\'ecommerce:send\');
';
		$this->document->setEcommerceGoogleGA(html_entity_decode($google_ecommerce_ga, ENT_QUOTES, 'UTF-8'));
	//NEW GTAG
		$ecommerce_products_gtag=substr_replace ( $ecommerce_products_gtag , "" , 0 ,1 );
		$ecommerce_products_gtag='gtag(\'event\', \'purchase\', {
"transaction_id": "'.$order_id.'",
"value": '.$products_price.',
"currency": "'.$this->session->data['currency'].'",
"items": ['.$ecommerce_products_gtag.']
});';
		$this->document->setEcommerceGoogleGTAG(html_entity_decode($ecommerce_products_gtag, ENT_QUOTES, 'UTF-8'));
	}
]]></add>
	</operation>
</file>

<file path="catalog/model/checkout/order.php">
	<operation>	 <!--     Remarketing - success page     -->
		<search><![CDATA[public function addOrder($data) {]]></search>
		<add position="before"><![CDATA[
	public function getCheckoutProducts($order_id) {
		$order_info = $this->getOrder($order_id);
		$order_product_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "order_product WHERE order_id = '" . (int)$order_id . "'");
		$order_products = array();
		foreach ($order_product_query->rows as $product) {
			$order_products[] = array(
				'model'    => str_replace(',','',$product['model']),
				'product_id'    => $product['product_id'],
				'name'    => $product['name'],
				'quantity'    => $product['quantity'],
				'price'    => $this->currency->format($product['price'] + ($this->config->get('config_tax') ? $product['tax'] : 0), $order_info['currency_code'], $order_info['currency_value'],false)
				);
		}
		return $order_products;
	}
]]></add>
	</operation>
</file>

<file path="catalog/controller/common/home.php">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA[$this->document->setTitle]]></search>
		<add position="before"><![CDATA[
	$this->load->model('catalog/category');
	$this->model_catalog_category->setGoogleTag("","","","home","home","'","'");
]]></add>
	</operation>
</file>

<file path="catalog/controller/account/success.php">
	<operation>
		<search><![CDATA[$this->document->setTitle]]></search>
		<add position="before"><![CDATA[
	$facebook_remarketing_tag=$this->config->get('config_remarketing_manager_facebook_code');
	$fb_quote = '&quot;';
	if (strpos($facebook_remarketing_tag, "PageView'")!==false){
		$fb_quote = "'";
	}
	if (strpos($facebook_remarketing_tag, "PageView")!==false){
		$fb_dynamic = 'CompleteRegistration'.$fb_quote.', {
content_name: \'CompleteRegistration\',
});';
		$facebook_remarketing_tag = str_replace('PageView'.$fb_quote.');','PageView'.$fb_quote.');fbq('.$fb_quote.'track'.$fb_quote.', '.$fb_quote.''.$fb_dynamic,$facebook_remarketing_tag);
	}
	$this->document->setRemarketingFacebook(html_entity_decode($facebook_remarketing_tag, ENT_QUOTES, 'UTF-8'));
]]></add>
	</operation>
</file>

<file path="catalog/view/theme/*/template/common/header*.tpl">
	<operation>	<!--     Remarketing     -->
		<search><![CDATA[</head>]]></search>
		<add position="before"><![CDATA[<?php if (isset($facebook_remarketing)) echo $facebook_remarketing; ?>]]></add>
	</operation>
</file>

<file path="catalog/view/theme/*/template/common/header*.tpl">
	<operation>	<!--     Remarketing/Conversion     -->
		<search><![CDATA[</head>]]></search>
		<add position="before"><![CDATA[<?php if (isset($google_adwords_code)) echo $google_adwords_code; ?>]]></add>
	</operation>
</file>

<file path="catalog/view/theme/*/template/common/header*.tpl">
	<operation>	<!--     Remarketing/Conversion     -->
		<search><![CDATA[<body]]></search>
		<add position="after"><![CDATA[<?php if (isset($google_legacy_code) && $google_legacy_code!="") echo '<div style="display:none;">'.$google_legacy_code.'</div>'; ?>]]></add>
	</operation>
</file>

<!-- Multistore Google Analytics START -->
<file path="admin/controller/setting/store.php">
	<operation>
		<search><![CDATA[$data['tab_server'] = $this->language->get('tab_server');]]></search>
			<add position="after"><![CDATA[
	$data['tab_google'] = $this->language->get('tab_google');
	$data['text_google_analytics'] = $this->language->get('text_google_analytics');
	$data['entry_google_analytics'] = $this->language->get('entry_google_analytics');
	$data['help_google_analytics'] = $this->language->get('help_google_analytics');
	$data['entry_status'] = $this->language->get('entry_status');
	$data['text_enabled'] = $this->language->get('text_enabled');
	$data['text_disabled'] = $this->language->get('text_disabled');]]></add>
	</operation>
</file>

<file path="admin/view/template/setting/store_form.tpl">
	<operation>
		<search><![CDATA["#tab-server"]]></search>
		<add position="before"><![CDATA[<li><a href="#tab-google" data-toggle="tab"><?php echo $tab_google; ?></a></li>]]></add>
	</operation>

	<operation>
		<search><![CDATA[id="tab-server"]]></search>
		<add position="before"><![CDATA[
	<div class="tab-pane" id="tab-google">
		<fieldset>
			<legend><?php echo $text_google_analytics; ?></legend>
			<div class="alert alert-info"><?php echo $help_google_analytics; ?></div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-analytics"><?php echo $entry_google_analytics; ?></label>
				<div class="col-sm-10">
					<textarea name="config_google_analytics" rows="5" placeholder="<?php echo $entry_google_analytics; ?>" id="input-google-analytics" class="form-control"><?php echo $config_google_analytics; ?></textarea>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-label" for="input-google-analytics-status"><?php echo $entry_status; ?></label>
				<div class="col-sm-10">
					<select name="config_google_analytics_status" id="input-google-analytics-status" class="form-control">
						<?php if ($config_google_analytics_status) { ?>
							<option value="1" selected="selected"><?php echo $text_enabled; ?></option>
							<option value="0"><?php echo $text_disabled; ?></option>
						<?php } else { ?>
							<option value="1"><?php echo $text_enabled; ?></option>
							<option value="0" selected="selected"><?php echo $text_disabled; ?></option>
						<?php } ?>
					</select>
				</div>
			</div>
		</fieldset>
	</div>
]]></add>
	</operation>
</file>
<!-- Multistore Google Analytics END -->

<file path="admin/view/template/catalog/category_form.tpl">	<!-- Product Feeds -->
	<operation>
	 <search><![CDATA[id="tab-data">]]></search>
	 <add position="after"><![CDATA[
	<?php if ($google_merchant_center_status || $facebook_catalog_status) { ?>
		<div class="form-group">
			<label class="col-sm-2 google-merchant-category" for="input-google-merchant-category"> <span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_merchant_category); ?>"><?php echo $entry_google_merchant_category; ?></span> </label>
			<div class="col-sm-10">
				<select name="google_merchant_category" id="input-google-merchant-category" class="form-control">
					<?php foreach ($google_merchant_category as $merchant_category) {
						if ($merchant_category['status']=="1") { ?>
							<option value="<?php echo $merchant_category['taxonomy_id']; ?>" selected="selected"><?php echo $merchant_category['name']; ?></option>
						<?php } else { ?>
							<option value="<?php echo $merchant_category['taxonomy_id']; ?>"><?php echo $merchant_category['name']; ?></option>
						<?php } ?>
					<?php } ?>
				</select>
			</div>
		</div>
	<?php } ?>
]]></add>
	</operation>
</file>

<file path="admin/controller/catalog/category.php">	<!-- Product Feeds -->
	<operation>
		<search><![CDATA[$this->load->model('design/layout');]]></search>
<add position="before"><![CDATA[
	$this->load->model('feed/google_merchant_center');
	$this->language->load('feed/google_merchant_center');

	$data['entry_google_merchant_category'] = $this->language->get('entry_google_merchant_category');
	$data['help_google_merchant_category'] = $this->language->get('help_google_merchant_category');

	if (isset($this->request->post['google_merchant_center_status'])) {
		$data['google_merchant_center_status'] = $this->request->post['google_merchant_center_status'];
	} else {
		$data['google_merchant_center_status'] = $this->config->get('google_merchant_center_status');
	}

	if (isset($this->request->post['facebook_catalog_status'])) {
		$data['facebook_catalog_status'] = $this->request->post['facebook_catalog_status'];
	} else {
		$data['facebook_catalog_status'] = $this->config->get('facebook_catalog_status');
	}

	$data['google_merchant_category'] = array();
	$google_taxonomy_category;
	if (isset($this->request->get['category_id'])) {
		$google_taxonomy_category = $this->model_feed_google_merchant_center->getCategory($this->request->get['category_id']);
	} else{
		$google_taxonomy_category = $this->model_feed_google_merchant_center->getCategory("");
	}

	foreach ($google_taxonomy_category as $google_category) {
		$data['google_merchant_category'][] = array (
			'taxonomy_id' => $google_category['taxonomy_id'],
			'status' => $google_category['status'],
			'name' => $google_category['name']
		);
	}
]]></add>
	</operation>

	<operation>
		<search><![CDATA[$this->model_catalog_category->addCategory($this->request->post);]]></search>
			<add position="after"><![CDATA[
	$this->load->model('feed/google_merchant_center');
	if (isset($this->request->get['category_id']) && isset($this->request->post['google_merchant_category'])) {
		$this->model_feed_google_merchant_center->saveCategory($this->request->post['google_merchant_category'],$this->request->get['category_id']);
	}
]]></add>
	</operation>

	<operation>
		<search><![CDATA[$this->model_catalog_category->editCategory($this->request->get['category_id'], $this->request->post);]]></search>
			<add position="after"><![CDATA[
	$this->load->model('feed/google_merchant_center');
	if (isset($this->request->get['category_id']) && isset($this->request->post['google_merchant_category'])) {
		$this->model_feed_google_merchant_center->saveCategory($this->request->post['google_merchant_category'],$this->request->get['category_id']);
	}
]]></add>
	</operation>

	<operation>
		<search><![CDATA[$this->model_catalog_category->deleteCategory($category_id);]]></search>
		<add position="after"><![CDATA[
	$this->model_feed_google_merchant_center->removeCategory($category_id);
]]></add>
	</operation>

	<operation>
		<search><![CDATA[public function delete() {]]></search>
		<add position="after"><![CDATA[
	$this->load->model('feed/google_merchant_center');
]]></add>
	</operation>
</file>

<file path="system/library/weight.php">	<!-- Product Feeds -->
	<operation>
		<search><![CDATA[public function format(]]></search>
			<add position="before"><![CDATA[
	public function weightTaxonomy($value, $weight_class_id, $decimal_point = '.', $thousand_point = '') {
		if (isset($this->weights[$weight_class_id])) {
			return number_format($value, 2, $decimal_point, $thousand_point) .' '. $this->weights[$weight_class_id]['unit'];
		} else {
			return number_format($value, 2, $decimal_point, $thousand_point);
		}
	}
]]></add>
	</operation>
</file>

<file path="system/library/cart/weight.php">	<!-- Product Feeds -->
	<operation>
		<search><![CDATA[public function format(]]></search>
		<add position="before"><![CDATA[
	public function weightTaxonomy($value, $weight_class_id, $decimal_point = '.', $thousand_point = '') {
		if (isset($this->weights[$weight_class_id])) {
			return number_format($value, 2, $decimal_point, $thousand_point) .' '. $this->weights[$weight_class_id]['unit'];
		} else {
			return number_format($value, 2, $decimal_point, $thousand_point);
		}
	}
]]></add>
	</operation>
</file>

<file path="admin/view/template/catalog/product_form.tpl">	<!-- Product Feeds -->
	<operation>
		<search><![CDATA[href="#tab-data"]]></search>
		<add position="before"><![CDATA[<?php if ($google_merchant_center_status) {?><li><a href="#tab-taxonomy" data-toggle="tab"><?php echo $tab_taxonomy; ?></a></li><?php } ?>]]></add>
	</operation>

	<operation>
		<search><![CDATA[<div class="tab-pane" id="tab-data">]]></search>
<add position="before"><![CDATA[
	<?php if ($google_merchant_center_status) {?>
		<div class="tab-pane" id="tab-taxonomy">
			<div class="form-group">
				<label class="col-sm-2 control-google-merchant-gender" for="input-google-merchant-gender"><?php echo $entry_google_merchant_gender; ?></label>
				<div class="col-sm-10">
					<select name="google_merchant_product_gender"  style="max-width: 90%;" id="input-google-merchant-product-gender" class="form-control">
						<?php foreach ($google_gender as $merchant_gender) {
							if ($merchant_gender==$google_merchant_product['gender']) { ?>
								<option value="<?php echo $merchant_gender; ?>" selected="selected"><?php echo $merchant_gender; ?></option>
							<?php } else { ?>
								<option value="<?php echo $merchant_gender; ?>"><?php echo $merchant_gender; ?></option>
							<?php } ?>
						<?php } ?>
					</select>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-2 control-google-merchant-age-group" for="input-google-merchant-age-group"><?php echo $entry_google_merchant_age_group; ?></label>
				<div class="col-sm-10">
					<select name="google_merchant_product_age_group" id="input-google-merchant-product-age-group" class="form-control">
						<?php foreach ($google_age_group as $merchant_age_group) {
							if ($merchant_age_group==$google_merchant_product['age_group']) { ?>
								<option value="<?php echo $merchant_age_group; ?>" selected="selected"><?php echo $merchant_age_group; ?></option>
							<?php } else { ?>
								<option value="<?php echo $merchant_age_group; ?>"><?php echo $merchant_age_group; ?></option>
							<?php } ?>
						<?php } ?>
					</select>
				</div>
			</div>
			<?php if ($google_merchant_center_attribute=="-1" || $google_merchant_center_attribute=="") {?>
				<div class="form-group">
					<label class="col-sm-2 control-google-merchant-color" for="input-google-merchant-color"><span data-toggle="tooltip" data-html="true" title="<?php echo htmlspecialchars($help_google_merchant_color); ?>"><?php echo $entry_google_merchant_color; ?></span></label>
					<div class="col-sm-10">
						<input type="text" name="google_merchant_product_color" value="<?php echo isset($google_merchant_product['color']) ? $google_merchant_product['color'] : ''; ?>" placeholder="<?php echo $entry_google_merchant_color; ?>" id="input-google-merchant-color" class="form-control" />
					</div>
				</div>
			<?php } ?>
		</div>
	<?php } ?>
	]]></add>
	</operation>
</file>

<file path="admin/controller/catalog/product.php">	<!-- Product Feeds -->
	<operation>
	 <search><![CDATA[$this->load->model('design/layout');]]></search>
	 <add position="before"><![CDATA[
	$this->load->model('feed/google_merchant_center');
	$this->language->load('feed/google_merchant_center');

	$data['entry_google_merchant_age_group'] = $this->language->get('entry_google_merchant_age_group');
	$data['entry_google_merchant_gender'] = $this->language->get('entry_google_merchant_gender');
	$data['entry_google_merchant_color'] = $this->language->get('entry_google_merchant_color');
	$data['help_google_merchant_color'] = $this->language->get('help_google_merchant_color');

	$data['tab_taxonomy'] = $this->language->get('tab_taxonomy');
	$data['google_age_group'] = array('adult','kids','toddler','infant','newborn');
	$data['google_gender'] = array('unisex','male','female');

	if (isset($this->request->post['google_merchant_center_status'])) {
		$data['google_merchant_center_status'] = $this->request->post['google_merchant_center_status'];
	} else {
		$data['google_merchant_center_status'] = $this->config->get('google_merchant_center_status');
	}

	if (isset($this->request->post['google_merchant_center_attribute'])) {
		$data['google_merchant_center_attribute'] = $this->request->post['google_merchant_center_attribute'];
	} else {
		$data['google_merchant_center_attribute'] = $this->config->get('google_merchant_center_attribute');
	}

	$data['google_merchant_product'] = array();
	$google_taxonomy_product;
	if (isset($this->request->get['product_id'])) {
		$google_taxonomy_product = $this->model_feed_google_merchant_center->getProduct($this->request->get['product_id']);
	}
	else{
		$google_taxonomy_product = $this->model_feed_google_merchant_center->getProduct("");
	}
	$data['google_merchant_product'] = $google_taxonomy_product;
]]></add>
	</operation>

	<operation>
		<search><![CDATA[$this->model_catalog_product->addProduct($this->request->post);]]></search>
			<add position="after"><![CDATA[
	$this->load->model('feed/google_merchant_center');
	if (isset($this->request->get['product_id']) && isset($this->request->post['google_merchant_product_gender']) && isset($this->request->post['google_merchant_product_age_group'])) {
		if (isset($this->request->post['google_merchant_product_color'])){
			$this->model_feed_google_merchant_center->saveProduct($this->request->get['product_id'],$this->request->post['google_merchant_product_gender'],$this->request->post['google_merchant_product_age_group'],$this->request->post['google_merchant_product_color']);
		} else {
			$this->model_feed_google_merchant_center->saveProduct($this->request->get['product_id'],$this->request->post['google_merchant_product_gender'],$this->request->post['google_merchant_product_age_group'],'');
		}
	}
]]></add>
	</operation>

	<operation>
			<search><![CDATA[$this->model_catalog_product->editProduct($this->request->get['product_id'], $this->request->post);]]></search>
				<add position="after"><![CDATA[
	$this->load->model('feed/google_merchant_center');
	if (isset($this->request->get['product_id']) && isset($this->request->post['google_merchant_product_gender']) && isset($this->request->post['google_merchant_product_age_group'])) {
		if (isset($this->request->post['google_merchant_product_color'])){
			$this->model_feed_google_merchant_center->saveProduct($this->request->get['product_id'],$this->request->post['google_merchant_product_gender'],$this->request->post['google_merchant_product_age_group'],$this->request->post['google_merchant_product_color']);
		} else {
			$this->model_feed_google_merchant_center->saveProduct($this->request->get['product_id'],$this->request->post['google_merchant_product_gender'],$this->request->post['google_merchant_product_age_group'],'');
		}
	}
]]></add>
	</operation>

	<operation>
		<search><![CDATA[$this->model_catalog_product->deleteProduct($product_id);]]></search>
			<add position="after"><![CDATA[$this->model_feed_google_merchant_center->removeProduct($product_id);]]></add>
	</operation>

	<operation>
		<search><![CDATA[public function delete() {]]></search>
		<add position="after"><![CDATA[
	$this->load->model('feed/google_merchant_center');
]]></add>
	</operation>
</file>

<file path="catalog/controller/common/language.php">	<!-- Product Feeds Multilang fix -->
	<operation>
		<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
	if (isset($_GET['language'])) {
		$this->session->data['language'] = $_GET['language'];
	}
]]></add>
	</operation>
</file>

<file path="catalog/controller/common/currency.php">	<!-- Product Feeds Multilang fix -->
	<operation>
		<search><![CDATA[public function index() {]]></search>
		<add position="after"><![CDATA[
	if (isset($_GET['currency'])) {
		$this->session->data['currency'] = $_GET['currency'];
	}
]]></add>
	</operation>
</file>

</modification>
